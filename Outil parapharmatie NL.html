<!DOCTYPE html>

<html lang="nl">
<head>
<meta charset="utf-8"/>
<meta content="width=device-width, initial-scale=1.0" name="viewport"/>
<title>Strategie &amp; Catalogus Paracorner Dierenarts</title>
<script src="https://cdn.tailwindcss.com"></script>
<style>
        /* Configuratie van het lettertype Inter */
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght%40100..900&display=swap');
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f3f4f6; /* Lichtgrijze achtergrond */
        }
        .header-color {
            background-color: #00594E; /* Deep Teal Primary */
        }
        .accent-color {
            color: #E56A54; /* Warm Red/Orange Accent */
        }
        .text-log-teal { color: #00594E; }
        .bg-log-teal { background-color: #E56A54; }
        .text-log-orange { color: #E56A54; }
        .bg-log-orange { background-color: #fef4f2; }
        
        .section-card {
            background-color: white;
            border-left: 5px solid #E56A54; /* Accent color border */
            box-shadow: 0 4px 12px -2px rgba(0, 0, 0, 0.05);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
            border-radius: 0.75rem; /* rounded-xl */
        }
        .section-card:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -4px rgba(0, 0, 0, 0.05);
        }
        h2 {
            border-bottom: 2px solid #e0e0e0;
            padding-bottom: 0.5rem;
        }

        /* Accordeon-stijlen */
        .accordion-header {
            cursor: pointer;
            padding: 1rem;
            border-bottom: 1px solid #f3f4f6;
            transition: background-color 0.2s;
        }
        .accordion-header:hover {
            background-color: #fef4f2;
        }
        .accordion-content {
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.5s ease-out, padding 0.5s ease-out;
            background-color: #ffffff;
        }
        .accordion-content.open {
            max-height: 8000px; /* Grote waarde */
            padding: 1rem;
            transition: max-height 0.5s ease-in, padding 0.5s ease-in;
        }
        .product-item {
            border: 1px solid #f3f4f6;
        }

        .language-toggle {
            display: inline-flex;
            background-color: #ffffff;
            border-radius: 9999px;
            padding: 0.25rem;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);
        }

        .language-toggle button {
            border: none;
            background: transparent;
            color: #00594E;
            font-weight: 600;
            padding: 0.35rem 0.85rem;
            border-radius: 9999px;
            cursor: pointer;
            transition: background-color 0.2s ease, color 0.2s ease;
        }

        .language-toggle button:hover {
            background-color: rgba(0, 89, 78, 0.1);
        }

        .language-toggle button.active {
            background-color: #00594E;
            color: #ffffff;
        }

        /* Selector-stijlen */
        .selector-bg { background-color: #f7f7f7; }
        .selector-border { border-color: #cccccc; }
        .selector-focus:focus { 
            border-color: #00594E; 
            box-shadow: 0 0 0 1px #00594E; 
        }
        .alert-error {
            background-color: #fee2e2;
            color: #b91c1c;
        }
        .alert-success {
            background-color: #d1fae5;
            color: #065f46;
        }
        .alert-warning {
            background-color: #fef3c7;
            color: #b45309;
        }

        /* Modal-stijlen (Nieuw) */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: rgba(0, 0, 0, 0.6);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.3s ease, visibility 0.3s ease;
        }
        .modal-overlay.open {
            opacity: 1;
            visibility: visible;
        }
        .modal-content {
            background-color: white;
            padding: 2rem;
            border-radius: 0.75rem;
            width: 90%;
            max-width: 600px;
            max-height: 90vh;
            overflow-y: auto;
            transform: scale(0.95);
            transition: transform 0.3s ease;
        }
        .modal-overlay.open .modal-content {
            transform: scale(1);
        }
        .modal-close-btn {
            background-color: #f3f4f6;
            border: none;
            border-radius: 9999px;
            width: 2rem;
            height: 2rem;
            position: absolute;
            top: 1rem;
            right: 1rem;
            cursor: pointer;
            font-weight: bold;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .modal-close-btn:hover {
            background-color: #e5e7eb;
        }
        .modal-body-content p {
            margin-bottom: 0.75rem;
        }
        .modal-body-content strong {
            color: #00594E; /* Teal */
        }

        /* Back-office styles */
        .backoffice-overlay {
            position: fixed;
            inset: 0;
            background-color: rgba(0, 0, 0, 0.55);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1100;
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.3s ease, visibility 0.3s ease;
        }

        .backoffice-overlay.open {
            opacity: 1;
            visibility: visible;
        }

        .backoffice-card {
            width: min(1100px, 96vw);
            max-height: 92vh;
            background: #ffffff;
            border-radius: 1rem;
            overflow: hidden;
            display: flex;
            flex-direction: column;
            box-shadow: 0 20px 45px rgba(0, 0, 0, 0.15);
        }

        .backoffice-header {
            background-color: #00594E;
            color: #ffffff;
            padding: 1.5rem 2rem;
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: 1rem;
        }

        .backoffice-tabs {
            display: flex;
            gap: 0.75rem;
            padding: 1rem 2rem 0.5rem;
            background-color: #f3f4f6;
            flex-wrap: wrap;
        }

        .backoffice-tab {
            padding: 0.5rem 1.25rem;
            border-radius: 999px;
            background-color: transparent;
            border: 1px solid transparent;
            font-weight: 600;
            color: #374151;
            transition: background-color 0.2s ease, color 0.2s ease, border-color 0.2s ease;
        }

        .backoffice-tab.active {
            background-color: #00594E;
            color: #ffffff;
            border-color: #00594E;
        }

        .backoffice-content {
            padding: 1.5rem 2rem 2rem;
            overflow-y: auto;
        }

        .backoffice-grid {
            display: grid;
            gap: 1.5rem;
        }

        @media (min-width: 1024px) {
            .backoffice-grid.two-columns {
                grid-template-columns: 320px 1fr;
            }
        }

        .backoffice-panel {
            border: 1px solid #e5e7eb;
            border-radius: 0.75rem;
            padding: 1rem;
            background-color: #fafafa;
        }

        .backoffice-panel h3 {
            font-size: 1.05rem;
            font-weight: 700;
            color: #00594E;
            margin-bottom: 0.75rem;
        }

        .backoffice-list {
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
            max-height: 55vh;
            overflow-y: auto;
        }

        .backoffice-list button {
            width: 100%;
            text-align: left;
            padding: 0.65rem 0.85rem;
            border-radius: 0.75rem;
            border: 1px solid transparent;
            background-color: #ffffff;
            transition: border-color 0.2s ease, box-shadow 0.2s ease;
        }

        .backoffice-list button:hover,
        .backoffice-list button.active {
            border-color: #00594E;
            box-shadow: 0 0 0 2px rgba(0, 89, 78, 0.12);
        }

        .backoffice-form label {
            font-weight: 600;
            color: #374151;
        }

        .backoffice-form input,
        .backoffice-form textarea,
        .backoffice-form select {
            width: 100%;
            border: 1px solid #d1d5db;
            border-radius: 0.75rem;
            padding: 0.6rem 0.75rem;
            color: #1f2937;
            background-color: #ffffff;
        }

        .backoffice-form textarea {
            min-height: 120px;
        }

        .backoffice-chip-group {
            display: flex;
            flex-wrap: wrap;
            gap: 0.5rem;
        }

        .backoffice-chip {
            display: inline-flex;
            align-items: center;
            gap: 0.4rem;
            border: 1px solid #d1d5db;
            border-radius: 999px;
            padding: 0.3rem 0.75rem;
            background-color: #ffffff;
            font-size: 0.85rem;
        }

        .backoffice-chip input {
            width: auto;
        }

        .backoffice-chip.missing-criteria {
            border-style: dashed;
            border-color: #f59e0b;
            background-color: #fef3c7;
        }

        .backoffice-actions {
            display: flex;
            flex-wrap: wrap;
            gap: 0.75rem;
            justify-content: flex-end;
            margin-top: 1.5rem;
        }

        .backoffice-actions button {
            border-radius: 999px;
            padding: 0.6rem 1.4rem;
            font-weight: 600;
        }

        .btn-primary {
            background-color: #00594E;
            color: #ffffff;
        }

        .btn-danger {
            background-color: #dc2626;
            color: #ffffff;
        }

        .btn-secondary {
            background-color: #e5e7eb;
            color: #111827;
        }

        .backoffice-login-card {
            background: #ffffff;
            width: min(420px, 92vw);
            padding: 2rem;
            border-radius: 1rem;
            display: flex;
            flex-direction: column;
            gap: 1.5rem;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.18);
        }

        .criteria-row {
            display: grid;
            gap: 0.75rem;
            grid-template-columns: repeat(auto-fit, minmax(160px, 1fr));
            align-items: flex-start;
        }

        .criteria-row input {
            width: 100%;
        }

        .criteria-row button {
            margin-top: 0.35rem;
        }

        .backoffice-hint {
            font-size: 0.85rem;
            color: #6b7280;
        }

        .input-error {
            border-color: #dc2626 !important;
            box-shadow: 0 0 0 2px rgba(220, 38, 38, 0.15);
        }
    </style>
<style>
  /* De zoekbalk dwingen om 100% van de box in te nemen */
  #search-modal #modal-free-text { width: 100%; display: block; }
  #search-modal select { width: 100%; display: block; }
</style>
<style>
/* Hide any compare-related UI completely */
#modal-results-list [data-action="compare-toggle"],
#modal-results-list input[data-action="compare-toggle"],
#modal-results-list label:has([data-action="compare-toggle"]),
#modal-open-compare,
#compare-fab,
#compare-drawer,
.compare-toggle { display: none !important; }
</style>
</head>
<body class="p-4 md:p-8">
<header class="header-color text-white py-16 rounded-b-3xl shadow-lg mb-8">
    <div class="max-w-5xl mx-auto flex flex-col gap-6">
        <div class="flex flex-col items-end gap-3 sm:flex-row sm:justify-end sm:items-center">
            <div class="language-toggle" role="group" aria-label="Taalselectie">
                <button class="active" data-language-btn="nl" aria-pressed="true">NL</button>
                <button data-language-btn="fr" aria-pressed="false">FR</button>
            </div>
            <button id="open-backoffice" class="inline-flex items-center gap-2 bg-white/10 hover:bg-white/20 text-white font-semibold px-4 py-2 rounded-full shadow transition" type="button">
                <span>Back Office</span>
                <svg class="w-4 h-4" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24" aria-hidden="true">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M16 12H8m8 0-3-3m3 3-3 3"></path>
                </svg>
            </button>
        </div>
        <div class="text-center space-y-3">
            <h1 class="text-4xl font-extrabold tracking-tight" data-i18n="headerTitle">Strategie &amp; Catalogus Paracorner Dierenarts</h1>
            <p class="text-lg font-light opacity-90" data-i18n="headerSubtitle">Versterk de veterinaire expertise en het onderscheid met het huismerk Purviso.</p>
        </div>
    </div>
</header>
<main class="space-y-12">
<section class="section-card p-0">
  <div class="accordion-header flex justify-between items-center text-lg font-semibold text-gray-800 rounded-t-xl" onclick="toggleAccordion('selector-content')">
    <span class="flex items-center">
      <span class="text-2xl mr-3">üîé</span> <span data-i18n="searchAccordionTitle">Zoeken &amp; Aanbeveling (inklapbaar)</span>
    </span>
    <svg class="w-5 h-5 transition-transform duration-300 text-log-teal" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path>
    </svg>
  </div>
  <div id="selector-content" class="accordion-content">
    <div class="p-6">

  <p class="text-gray-700 mb-4" data-i18n="searchIntro">
    Selecteer de specifieke criteria van het dier. De tool <strong>geeft voorrang aan Purviso‚Äëproducten</strong> en toont andere compatibele alternatieven.
  </p>
  <div class="space-y-6 p-4 rounded-lg selector-bg selector-border border" id="selector-form">
    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
      <div>
        <label class="block text-sm font-medium text-gray-700 mb-2" for="species" data-i18n="speciesLabel">A. Soort</label>
        <select id="species" class="w-full p-3 bg-white border border-gray-300 rounded-lg text-gray-800 selector-focus transition duration-150 ease-in-out">
          <option value="" selected disabled>‚Ä¢‚Ä¢‚Ä¢</option>
        </select>
      </div>
      <div>
        <label class="block text-sm font-medium text-gray-700 mb-2" for="age" data-i18n="ageLabel">B. Leeftijdscategorie</label>
        <select id="age" class="w-full p-3 bg-white border border-gray-300 rounded-lg text-gray-800 selector-focus transition duration-150 ease-in-out">
          <option value="" selected disabled>‚Ä¢‚Ä¢‚Ä¢</option>
        </select>
      </div>
    </div>
    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
      <div>
        <label class="block text-sm font-medium text-gray-700 mb-2" for="need" data-i18n="needLabel">C. Wat is de hoofdbehoefte?</label>
        <select id="need" class="w-full p-3 bg-white border border-gray-300 rounded-lg text-gray-800 selector-focus transition duration-150 ease-in-out">
          <option value="" selected disabled>‚Ä¢‚Ä¢‚Ä¢</option>
        </select>
      </div>
      <div>
        <label class="block text-sm font-medium text-gray-700 mb-2" for="level" data-i18n="levelLabel">D. Wat is de ernst van het probleem?</label>
        <select id="level" class="w-full p-3 bg-white border border-gray-300 rounded-lg text-gray-800 selector-focus transition duration-150 ease-in-out">
          <option value="" selected disabled>‚Ä¢‚Ä¢‚Ä¢</option>
        </select>
      </div>
    </div>
    <div>
      <label class="block text-sm font-medium text-gray-700 mb-2" for="healthNotes" data-i18n="healthNotesLabel">E. Gezondheidsnotities (optioneel)</label>
      <input id="healthNotes" type="text" placeholder="Bijv.: Diabetes, bekende allergie..." data-i18n-placeholder="healthNotesPlaceholder" class="w-full p-3 bg-white border border-gray-300 rounded-lg text-gray-800 selector-focus transition duration-150 ease-in-out" />
      <p class="text-xs text-gray-500 mt-1" data-i18n="healthNotesHint">Als het dier een andere ernstige gezondheidskwestie heeft, <strong>adviseer altijd een dierenartsconsult</strong> v√≥√≥r de verkoop van een supplement.</p>
    </div>
    <div id="message" role="alert" class="hidden p-3 rounded-lg text-sm font-medium mt-4"></div>
    <button onclick="findProduct()" class="w-full py-3 mt-4 bg-[#E56A54] hover:bg-[#d35543] text-white font-semibold rounded-lg shadow-md transition duration-200 ease-in-out transform hover:scale-[1.01] focus:outline-none focus:ring-4 focus:ring-[#E56A54] focus:ring-opacity-50" data-i18n="analyzeButton">
      Analyse en aanbeveling genereren
    </button>
<div class="flex gap-3 mt-3">
  <button type="button"
          onclick="resetSelector()"
          class="w-full py-3 bg-gray-200 hover:bg-gray-300 text-gray-800 font-semibold rounded-lg shadow-sm transition duration-150 ease-in-out" data-i18n="resetButton">
    Criteria resetten
  </button>
</div>

  </div>

    </div>
  </div>
</section>

<section class="p-6 section-card">
  <h2 class="text-2xl font-bold text-gray-800 mb-4 flex items-center">
    <svg class="w-6 h-6 mr-3 accent-color" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 11H5m14 0a2 2 0 012 2v6a2 2 0 01-2 2H5a2 2 0 01-2-2v-6a2 2 0 012-2m14 0V9a2 2 0 00-2-2M5 11V9a2 2 0 012-2m0 0V5a2 2 0 012-2h6a2 2 0 012 2v2M5 7h14"></path>
    </svg>
    <span data-i18n="supplementsHeading">1. Opleidingscatalogus (Alle Supplementen)</span>
  </h2>
  <p class="text-gray-700 mb-4" data-i18n="supplementsDescription">Volledige lijst van alle supplementen in het planogram, gegroepeerd per behoefte.</p>
  <div id="full-supplements-accordion" class="border border-gray-200 rounded-lg overflow-hidden shadow-sm">
    </div>
</section>

<section class="p-6 section-card">
  <h2 class="text-2xl font-bold text-gray-800 mb-4 flex items-center">
    <svg class="w-6 h-6 mr-3 accent-color" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 3v4M3 5h4M6 17v4m-2-2h4M18 5h-4M21 3v4M10 21v-4m0 4h4m-4 0H6m11-5a5 5 0 01-5-5V6a5 5 0 015-5m-5 5a5 5 0 00-5 5v5a5 5 0 005 5m0-10a5 5 0 015 5"></path>
    </svg>
    <span data-i18n="careHeading">2. Opleidingscatalogus (Alle Verzorgingsproducten)</span>
  </h2>
  <p class="text-gray-700 mb-4" data-i18n="careDescription">Volledige lijst van alle verzorgingsproducten in het planogram, gegroepeerd per behoefte.</p>
  <div id="full-care-accordion" class="border border-gray-200 rounded-lg overflow-hidden shadow-sm">
    </div>
</section>


</main>
<footer class="mt-12 p-4 text-center bg-white rounded-xl text-gray-600 text-sm shadow-md" data-i18n="footerText">
        Intern Strategisch Document - T&amp;C Parafarmacie
    </footer>
<div class="modal-overlay" id="product-modal" onclick="closeProductModal()">
<div class="modal-content relative" onclick="event.stopPropagation()">
<button class="modal-close-btn" onclick="closeProductModal()">√ó</button>
<h3 class="text-2xl font-bold text-log-teal mb-4" id="modal-title"></h3>
<div class="modal-body-content text-gray-700" id="modal-body">
</div>
</div>
</div>

<div class="backoffice-overlay" id="backoffice-login">
    <div class="backoffice-login-card">
        <div>
            <h2 class="text-2xl font-bold text-gray-900">Connexion back office</h2>
            <p class="text-sm text-gray-600">Entrez le code d‚Äôacc√®s pour g√©rer les contenus du programme.</p>
        </div>
        <label class="flex flex-col gap-2 text-sm font-semibold text-gray-700">
            Code d‚Äôacc√®s
            <input type="password" id="backoffice-code" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢" class="rounded-lg border border-gray-300 px-3 py-2" />
        </label>
        <p id="backoffice-login-error" class="text-sm text-red-600 hidden">Code incorrect, veuillez r√©essayer.</p>
        <div class="flex justify-end gap-3">
            <button type="button" class="btn-secondary" onclick="closeBackOfficeLogin()">Annuler</button>
            <button type="button" class="btn-primary" id="backoffice-auth-btn">Se connecter</button>
        </div>
        <p class="text-xs text-gray-400">Code requis : Welc0me</p>
    </div>
</div>

<div class="backoffice-overlay" id="backoffice-panel">
    <div class="backoffice-card">
        <div class="backoffice-header">
            <div>
                <h2 class="text-2xl font-bold">Back Office</h2>
                <p class="text-sm text-white/80">G√©rez les produits, traductions et crit√®res de recherche.</p>
            </div>
            <button type="button" class="btn-secondary" onclick="closeBackOfficePanel()">Fermer</button>
        </div>
        <div class="backoffice-tabs">
            <button type="button" class="backoffice-tab active" data-tab="products">Produits</button>
            <button type="button" class="backoffice-tab" data-tab="criteria">Crit√®res</button>
            <button type="button" class="backoffice-tab" data-tab="settings">Param√®tres</button>
        </div>
        <div class="backoffice-content" id="backoffice-content">
            <!-- Dynamically populated -->
        </div>
    </div>
</div>
<script>
        const STORAGE_KEYS = {
            products: 'paracorner.backoffice.products',
            translations: 'paracorner.backoffice.translations',
            criteria: 'paracorner.backoffice.criteria'
        };

        const ACCESS_CODE = 'Welc0me';

        function deepClone(value) {
            if (value === undefined) return undefined;
            if (value === null) return null;
            try {
                return JSON.parse(JSON.stringify(value));
            } catch (error) {
                console.warn('Unable to clone value, returning original reference', error);
                return value;
            }
        }

        function loadFromStorage(key, fallback) {
            try {
                if (typeof window === 'undefined' || !window.localStorage) {
                    return deepClone(fallback);
                }
                const raw = window.localStorage.getItem(key);
                if (!raw) {
                    return deepClone(fallback);
                }
                const parsed = JSON.parse(raw);
                if (Array.isArray(fallback)) {
                    return Array.isArray(parsed) ? parsed : deepClone(fallback);
                }
                if (fallback && typeof fallback === 'object') {
                    return parsed && typeof parsed === 'object' ? parsed : deepClone(fallback);
                }
                return parsed;
            } catch (error) {
                console.warn('Unable to load data from storage', error);
                return deepClone(fallback);
            }
        }

        function saveToStorage(key, value) {
            try {
                if (typeof window === 'undefined' || !window.localStorage) {
                    return;
                }
                window.localStorage.setItem(key, JSON.stringify(value));
            } catch (error) {
                console.warn('Unable to save data in storage', error);
            }
        }

        function ensureProductDataStructure(rawProducts, defaults) {
            if (!Array.isArray(rawProducts) || rawProducts.length === 0) {
                return { data: deepClone(defaults), changed: true };
            }

            const isNonEmptyString = value => typeof value === 'string' && value.trim() !== '';
            const isNonEmptyArrayOfStrings = value => Array.isArray(value) && value.length > 0 && value.every(item => typeof item === 'string' && item.trim() !== '');

            const isValidProduct = product => (
                product &&
                isNonEmptyString(product.id) &&
                isNonEmptyString(product.name) &&
                isNonEmptyString(product.category) &&
                isNonEmptyArrayOfStrings(product.need) &&
                isNonEmptyArrayOfStrings(product.level) &&
                isNonEmptyArrayOfStrings(product.species)
            );

            const hasInvalidEntry = rawProducts.some(product => !isValidProduct(product));
            if (hasInvalidEntry) {
                return { data: deepClone(defaults), changed: true };
            }

            return { data: rawProducts, changed: false };
        }

        function ensureTranslationStructure(rawTranslations, defaultsSource) {
            const defaults = deepClone(defaultsSource);

            if (!rawTranslations || typeof rawTranslations !== 'object') {
                return { data: defaults, changed: true };
            }

            const result = deepClone(rawTranslations);
            if (!result.fr || typeof result.fr !== 'object') {
                result.fr = {};
            }

            let changed = false;

            Object.entries(defaults.fr || {}).forEach(([productId, fields]) => {
                if (!result.fr[productId] || typeof result.fr[productId] !== 'object') {
                    result.fr[productId] = fields;
                    changed = true;
                    return;
                }

                Object.entries(fields).forEach(([field, text]) => {
                    if (typeof result.fr[productId][field] !== 'string' || result.fr[productId][field].trim() === '') {
                        result.fr[productId][field] = text;
                        changed = true;
                    }
                });
            });

            return { data: result, changed };
        }

        function sanitizeCriteriaList(rawList, defaultList) {
            if (!Array.isArray(rawList) || rawList.length === 0) {
                return { data: deepClone(defaultList), changed: true };
            }

            const sanitized = [];
            let changed = false;

            rawList.forEach(item => {
                if (!item || typeof item.value !== 'string') {
                    changed = true;
                    return;
                }

                const value = item.value.trim();
                if (!value) {
                    changed = true;
                    return;
                }

                const defaultEntry = defaultList.find(entry => entry.value === value);
                const defaultLabels = defaultEntry && defaultEntry.labels ? defaultEntry.labels : {};
                const labels = (item.labels && typeof item.labels === 'object') ? { ...item.labels } : {};

                if (!labels.nl && defaultLabels.nl) {
                    labels.nl = defaultLabels.nl;
                    changed = true;
                }
                if (!labels.fr && defaultLabels.fr) {
                    labels.fr = defaultLabels.fr;
                    changed = true;
                }

                sanitized.push({ value, labels });
            });

            if (sanitized.length === 0) {
                return { data: deepClone(defaultList), changed: true };
            }

            if (sanitized.length !== rawList.length) {
                changed = true;
            }

            return { data: sanitized, changed };
        }

        function ensureCriteriaStructure(rawCriteria, defaultsSource) {
            const defaults = deepClone(defaultsSource);

            if (!rawCriteria || typeof rawCriteria !== 'object') {
                return { data: defaults, changed: true };
            }

            const result = { ...rawCriteria };
            let changed = false;

            ['species', 'age', 'need', 'level'].forEach(key => {
                const { data, changed: listChanged } = sanitizeCriteriaList(result[key], defaults[key]);
                result[key] = data;
                if (listChanged) {
                    changed = true;
                }
            });

            return { data: result, changed };
        }

        const DEFAULT_SEARCH_CRITERIA = {
            species: [
                { value: 'hond', labels: { nl: 'üê∂ Hond', fr: 'üê∂ Chien' } },
                { value: 'kat', labels: { nl: 'üê± Kat', fr: 'üê± Chat' } },
                { value: 'rongeur', labels: { nl: 'üê∞ Knaagdier / Klein Zoogdier', fr: 'üê∞ Rongeur / Petit mammif√®re' } }
            ],
            age: [
                { value: 'jeune', labels: { nl: 'Jong (Groei / Puppy / Kitten)', fr: 'Jeune (Croissance / Chiot / Chaton)' } },
                { value: 'adulte', labels: { nl: 'Volwassen (Volledige maturiteit)', fr: 'Adulte (Pleine maturit√©)' } },
                { value: 'senior', labels: { nl: 'Senior (Gevorderde leeftijd)', fr: 'Senior (√Çge avanc√©)' } }
            ],
            need: [
                { value: 'articulations', labels: { nl: 'ü¶¥ Gewrichten', fr: 'ü¶¥ Articulations' } },
                { value: 'digestion', labels: { nl: 'ü¶† Spijsvertering & Anaalklieren', fr: 'ü¶† Digestion & Glandes anales' } },
                { value: 'skin_care', labels: { nl: 'üßº Huid & Vacht (Verzorging)', fr: 'üßº Peau & Pelage (Soin)' } },
                { value: 'skin_supplement', labels: { nl: '‚ú® Huid & Vacht (Supplement)', fr: '‚ú® Peau & Pelage (Compl√©ment)' } },
                { value: 'anxiety', labels: { nl: 'üßò Angst & Stress', fr: 'üßò Anxi√©t√© & Stress' } },
                { value: 'hygiene_dental', labels: { nl: 'ü¶∑ Mondhygi√´ne', fr: 'ü¶∑ Hygi√®ne bucco-dentaire' } },
                { value: 'hygiene_eyes', labels: { nl: 'üëÅÔ∏è Ooghygi√´ne', fr: 'üëÅÔ∏è Hygi√®ne oculaire' } },
                { value: 'hygiene_ears', labels: { nl: 'üëÇ Oorhygi√´ne', fr: 'üëÇ Hygi√®ne auriculaire' } },
                { value: 'wounds', labels: { nl: 'ü©π Wonden & Pootjes', fr: 'ü©π Plaies & Coussinets' } },
                { value: 'urinary', labels: { nl: 'üíß Urinaire Weg', fr: 'üíß Voie urinaire' } },
                { value: 'liver', labels: { nl: 'üß° Lever', fr: 'üß° Foie' } },
                { value: 'recovery', labels: { nl: '‚è≥ Herstel & Vitaminen', fr: '‚è≥ R√©cup√©ration & Vitamines' } },
                { value: 'puppy_kitten', labels: { nl: 'üêæ Puppy & Kitten', fr: 'üêæ Chiot & Chaton' } }
            ],
            level: [
                { value: 'prevention', labels: { nl: 'Licht / Preventie / Onderhoud', fr: 'L√©ger / Pr√©vention / Entretien' } },
                { value: 'advanced', labels: { nl: 'Gevorderd / Duidelijke symptomen / Intensief', fr: 'Avanc√© / Sympt√¥mes marqu√©s / Intensif' } }
            ]
        };

        // --- NIEUWE CENTRALE DATABASE (vervangt ALLE oude gegevens) ---

        const DEFAULT_PRODUCT_DATABASE = [
            // --- SUPPLEMENTEN ---
            // Urinaire Weg
            {
                id: 'vetoquinol_calculs',
                name: "Vetoquinol Care Gel Calculs urinaires 120 g",
                isPurviso: false,
                brand: "Vetoquinol",
                category: "Supplements",
                need: ['urinary'],
                level: ['advanced'],
                species: ['hond', 'kat'],
                age: ['adulte', 'senior'],
                objective: "Voedingssupplement voor katten en honden die de neiging hebben om blaasstenen/kristallen in de urinewegen te ontwikkelen. Helpt bij het oplossen van urinestenen (struviet).",
                admin: "<strong>Honden en katten.</strong> Dagelijks toedienen. In de mond of op het voer/drinkwater. <br><strong>Katten:</strong> ¬Ω √† 1 theelepel (3 √† 6 g) 2 √† 3 keer per dag. <br><strong>Honden:</strong> ¬Ω √† 3 theelepels 2 √† 3 keer/dag. <br><strong>Duur:</strong> maximaal 6 maanden.",
                warning: "Het is aanbevolen v√≥√≥r gebruik een dierenarts te raadplegen.",
                tomCoUrl: null
            },
            {
                id: 'dermoscent_uti_zen',
                name: "Dermoscent Uti-Zen Hond en Kat 30 tabletten",
                isPurviso: false,
                brand: "Dermoscent",
                category: "Supplements",
                need: ['urinary'],
                level: ['prevention'],
                species: ['hond', 'kat'],
                age: ['jeune', 'adulte', 'senior'],
                objective: "Voedingssupplement ter ondersteuning van de urinewegen. Bevat cranberry-extract. Kan worden toegediend gedurende de behandeling en helpt bij het voorkomen van terugkerende infecties.",
                admin: "<strong>Hond en kat.</strong> E√©n keer per dag toedienen. <br><strong>0-10 kg:</strong> ¬Ω tablet/dag. <br><strong>10-20 kg:</strong> 1 tablet/dag. <br><strong>20-40 kg:</strong> 2 tabletten/dag.",
                warning: "Een regelmatige en continue toediening wordt aanbevolen voor een optimaal resultaat.",
                tomCoUrl: null
            },
            // Lever
            {
                id: 'epato_pate',
                name: "Epato Pasta 2 x 15 ml",
                isPurviso: false,
                brand: "Epato",
                category: "Supplements",
                need: ['liver'],
                level: ['advanced'],
                species: ['kat'],
                age: ['adulte', 'senior'],
                objective: "Beschermt de lever en herstelt de leverfunctie bij de kat. Voor katten die lijden aan een leveraandoening of een medicamenteuze behandeling volgen.",
                admin: "<strong>Kat.</strong> √©√©n keer per dag, mengen met het voer of rechtstreeks in de bek. <br><strong>Dosering:</strong> 1 ml per 5 kg lichaamsgewicht.",
                warning: "Raadpleeg uw dierenarts v√≥√≥r gebruik. Wij bevelen dagelijkse toediening gedurende minimaal 30 dagen aan.",
                tomCoUrl: null
            },
            // Herstel en Veroudering
            {
                id: 'vetoquinol_energie',
                name: "Vetoquinol Care Gel Energie 120 g",
                isPurviso: false,
                brand: "Vetoquinol",
                category: "Supplements",
                need: ['recovery'],
                level: ['advanced'],
                species: ['hond', 'kat'],
                age: ['jeune', 'adulte', 'senior'],
                objective: "Extra energietoevoer. Ondersteunt gedurende het herstel/ziekte, intense fysieke inspanning en groei. Helpt bij verlies van eetlust.",
                admin: "<strong>Honden en katten, alle leeftijden.</strong> Dagelijks. <br><strong>Honden (per 10 kg):</strong> 1 eetlepel (18 g)/dag. <br><strong>Katten (per 3-5 kg):</strong> 1 theelepel (6 g)/dag.",
                warning: null,
                tomCoUrl: null
            },
            {
                id: 'lysine_mp',
                name: "Lysine MP 100 capsules",
                isPurviso: false,
                brand: "MP Labo",
                category: "Supplements",
                need: ['recovery'],
                level: ['prevention', 'advanced'],
                species: ['kat'],
                age: ['jeune', 'adulte', 'senior'],
                objective: "Voedingssupplement voor katten waarvan het immuunsysteem verzwakt is. Ondersteunt in periode van stress, ziekte of inspanning. Geschikt in geval van herpesvirus.",
                admin: "<strong>Kat.</strong> <br><strong>Kittens:</strong> 1 √† 2 capsules/dag. <br><strong>Katten:</strong> 1 √† 2 capsules 's ochtends en 's avonds.",
                warning: "Rechtstreeks toedienen of over het voer strooien.",
                tomCoUrl: null
            },
            {
                id: 'dermoscent_senior',
                name: "Dermoscent Senior Spot-On (Alle Groottes)",
                isPurviso: false,
                brand: "Dermoscent",
                category: "Supplements",
                need: ['recovery', 'skin_supplement'],
                level: ['prevention'],
                species: ['hond', 'kat'],
                age: ['senior'],
                objective: "Spot-on ter ondersteuning van de huid en vacht van oudere dieren. Bevat antioxidanten, hydrateert en geeft soepelheid terug. Geeft meer vitaliteit.",
                admin: "<strong>Kat en Hond (volgens grootte).</strong> 1 pipet per week gedurende 2 maanden, daarna 1 pipet om de 2 weken (onderhoud).",
                warning: "Duw de vacht opzij en breng aan tussen de schouderbladen. Het dier niet wassen gedurende 48 uur.",
                tomCoUrl: null
            },
            // Angst en Stress
            {
                id: 'purviso_relax',
                name: "Purviso Plus Relax 90 kauwbrokjes",
                isPurviso: true,
                brand: "Purviso",
                category: "Supplements",
                need: ['anxiety'],
                level: ['prevention', 'advanced'],
                species: ['hond', 'kat'],
                age: ['adulte', 'senior'], // PPT dit "vanaf 4 maanden" mais Purviso-only data disait "adulte"
                objective: "Kalmte en Sereniteit. Geformuleerd met Œ±-casozepine en L-Theanine. Helpt bij het beheersen van stress (reizen, geluiden, veranderingen).",
                admin: "<strong>Volwassen kat en hond vanaf 4 maanden.</strong> <br><strong>Dosering:</strong> 1 brok per 10 kg lichaamsgewicht.",
                warning: "Alternatief voor Zylk√®ne, Sativavet.",
                tomCoUrl: null
            },
            {
                id: 'zylkene_chew',
                name: "ZYLKENE CHEW DOG (S, M, M/L)",
                isPurviso: false,
                brand: "Zylkene",
                category: "Supplements",
                need: ['anxiety'],
                level: ['prevention', 'advanced'],
                species: ['hond'],
                age: ['adulte', 'senior'],
                objective: "Kauwtabletten voor honden om stress te verminderen (vuurwerk, reizen, dierenarts, verlatingsangst, enz.). Bevat Œ±‚Äëcasozepine.",
                admin: "<strong>Honden.</strong> Dosering varieert volgens het gewicht (zie verpakking). <br><strong><10 kg:</strong> <5kg=1/dag, 5-10kg=2/dag. <br><strong>10-30 kg:</strong> 10-15kg=1/dag, 15-30kg=2/dag. <br><strong>15-60 kg:</strong> 15-30kg=1/dag, 30-60kg=2/dag. <br><strong>Let op:</strong> De dosering van Zylkene is officieel gebaseerd op de verpakking van het product. Dit zijn algemene richtlijnen.",
                warning: "Begin 1 √† 2 dagen voor het stressvolle moment. Alternatief als huismerk = Purviso Plus Relax.",
                tomCoUrl: null
            },
            {
                id: 'anibidiol_nature',
                name: "Anibidiol Nature 5 hond & kat 60 capsules",
                isPurviso: false,
                brand: "Anibidiol",
                category: "Supplements",
                need: ['anxiety', 'articulations'],
                level: ['prevention', 'advanced'],
                species: ['hond', 'kat'],
                age: ['adulte', 'senior'], // Impliqu√© par le dosage
                objective: "Voedingssupplement op basis van hennepzaadolie en CBD. Bevordert het welzijn, het gedrag en de ontspanning. Ondersteunt het zenuwstelsel en de vitaliteit.",
                admin: "<strong>Hond en kat.</strong> Oraal, dagelijks. <br><strong>5 kg:</strong> 1 √† 4 capsules/dag. <br><strong>10 kg:</strong> 1 √† 8 capsules/dag. <br><strong>15 kg:</strong> 1 √† 12 capsules/dag. <br><strong>20 kg:</strong> 2 √† 16 capsules/dag.",
                warning: "Geef de hele capsule of de inhoud ervan. Moet gedurende minstens 5 weken worden toegediend. <0,2 % de THC.",
                tomCoUrl: null
            },
            // Multivitaminen
            {
                id: 'purviso_vitality',
                name: "Purviso Plus Vitality Boost 90 kauwbrokjes",
                isPurviso: true,
                brand: "Purviso",
                category: "Supplements",
                need: ['recovery'],
                level: ['prevention'],
                species: ['hond', 'kat'],
                age: ['adulte', 'senior'], // "vanaf 4 maanden"
                objective: "Volledige Multivitaminen. Bevordert de algemene gezondheid en versterkt het immuunsysteem. Bevat meer dan 20 vitaminen en mineralen.",
                admin: "<strong>Volwassen kat en hond vanaf 4 maanden.</strong> <br><strong>Dosering:</strong> 1 brok per 10 kg lichaamsgewicht.",
                warning: "Alternatief voor Optiform, Viti5.",
                tomCoUrl: null
            },
            // Gewrichten
            {
                id: 'purviso_mobility_forte',
                name: "Purviso Plus Mobility Forte 90 kauwbrokjes",
                isPurviso: true,
                brand: "Purviso",
                category: "Supplements",
                need: ['articulations'],
                level: ['advanced'],
                species: ['hond'],
                age: ['adulte', 'senior'], // "vanaf 4 maanden"
                objective: "Intensieve Reparatie. Richt zich op gevorderde artrose. Bevat niet-gedenatureerd type II collageen en Boswellia Serrata.",
                admin: "<strong>Hond vanaf 4 maanden.</strong> <br><strong>< 20kg:</strong> 1 brok/dag. <br><strong>> 20kg:</strong> 2 kauwbrokjes/dag.",
                warning: "Alternatief voor Flexadin Advance, Seraquin Omega.",
                tomCoUrl: null
            },
            {
                id: 'purviso_mobility_support',
                name: "Purviso Plus Mobility Support 90 kauwbrokjes",
                isPurviso: true,
                brand: "Purviso",
                category: "Supplements",
                need: ['articulations'],
                level: ['prevention'],
                species: ['hond'],
                age: ['jeune', 'adulte', 'senior'], // "vanaf 4 maanden"
                objective: "Bescherming en Souplesse. Ideaal ter preventie of bij beginnende artrose. Glucosamine, MSM en Hyaluronzuur.",
                admin: "<strong>Hond vanaf 4 maanden.</strong> <br><strong>< 30kg:</strong> 1 brok/dag. <br><strong>> 30kg:</strong> 2 kauwbrokjes/dag.",
                warning: "Alternatief voor Flexadin Plus, Flexadin Adult.",
                tomCoUrl: null
            },
            {
                id: 'flexadin_advanced_boswellia',
                name: "Flexadin Advanced Boswellia 60 kauwbrokjes",
                isPurviso: false,
                brand: "Flexadin",
                category: "Supplements",
                need: ['articulations'],
                level: ['advanced'],
                species: ['hond'],
                age: ['adulte', 'senior'],
                objective: "Ondersteunt de gewrichtsfunctie bij honden die lijden aan artrose en osteoartritis. Bevat UC-II¬Æ (collageen type II).",
                admin: "<strong>Volwassen hond.</strong> 1 kauwbrok per dag (ongeacht het gewicht).",
                warning: "Alternatief als huismerk = Purviso Plus Mobility Forte.",
                tomCoUrl: null
            },
            {
                id: 'flexadin_adult_dog',
                name: "FLEXADIN ADULT DOG 70PC",
                isPurviso: false,
                brand: "Flexadin",
                category: "Supplements",
                need: ['articulations'],
                level: ['prevention'],
                species: ['hond'],
                age: ['adulte', 'senior'],
                objective: "Voedingssupplement voor volwassen honden en senioren (vanaf 2 jaar) bedoeld om de gewrichten te ondersteunen (preventief).",
                admin: "<strong>Volwassen en senior hond (vanaf 2 jaar).</strong> 1 kauwbrok per dag (ongeacht het gewicht).",
                warning: "Alternatief als huismerk = Purviso Plus Mobility Support.",
                tomCoUrl: null
            },
            {
                id: 'flexadin_young_maxi',
                name: "FLEXADIN YOUNG DOG MAXI 60PC",
                isPurviso: false,
                brand: "Flexadin",
                category: "Supplements",
                need: ['articulations'],
                level: ['prevention'],
                species: ['hond'],
                age: ['jeune'], // "6 maanden √† 2 ans"
                objective: "Voedingssupplement voor puppy's en jonge honden (6 maanden tot 2 jaar) van GROTE omvang (>10kg) bedoeld om de gewrichten te ondersteunen.",
                admin: "<strong>puppy's en jonge honden (6 maanden tot 2 jaar) > 10kg.</strong> <br><strong>10-30 kg:</strong> 1/dag. <br><strong>>30 kg:</strong> 2/dag.",
                warning: "Alternatief als huismerk = Purviso Plus Mobility Support.",
                tomCoUrl: null
            },
            {
                id: 'flexadin_young_mini',
                name: "FLEXADIN YOUNG DOG MINI 60PC",
                isPurviso: false,
                brand: "Flexadin",
                category: "Supplements",
                need: ['articulations'],
                level: ['prevention'],
                species: ['hond'],
                age: ['jeune'], // "6 maanden √† 2 ans"
                objective: "Voedingssupplement voor puppy's en jonge honden (6 maanden tot 2 jaar) van KLEINE omvang (<10kg) bedoeld om de gewrichten te ondersteunen.",
                admin: "<strong>puppy's en jonge honden (6 maanden tot 2 jaar) < 10kg.</strong> <br><strong><6 kg:</strong> 1/dag. <br><strong>6-10 kg:</strong> 2/dag.",
                warning: "Alternatief als huismerk = Purviso Plus Mobility Support.",
                tomCoUrl: null
            },
            {
                id: 'seraquin_omega_chien',
                name: "Seraquin Omega Hond 60 tabletten",
                isPurviso: false,
                brand: "Seraquin",
                category: "Supplements",
                need: ['articulations'],
                level: ['prevention', 'advanced'],
                species: ['hond'],
                age: ['jeune', 'adulte', 'senior'],
                objective: "Ondersteunt de gewrichten van honden (snelgroeiende jonge dieren, sporthonden, bewezen artrose). Verrijkt met kurkuma en omega-3.",
                admin: "<strong>Hond.</strong> <br><strong><10 kg:</strong> 1/dag. <br><strong>10-20 kg:</strong> 2/dag. <br><strong>20-40 kg:</strong> 3/dag. <br><strong>>40 kg:</strong> 4/dag.",
                warning: "Onderhoudsdosering = de helft van de startdosis na 4-6 weken. Alternatief als huismerk = Purviso Plus Mobility Forte.",
                tomCoUrl: null
            },
            {
                id: 'flexadin_advanced_chat',
                name: "Flexadin Advanced Kat 60 kauwbrokjes",
                isPurviso: false,
                brand: "Flexadin",
                category: "Supplements",
                need: ['articulations'],
                level: ['advanced'],
                species: ['kat'],
                age: ['adulte', 'senior'],
                objective: "Ondersteunt de gewrichtsfunctie bij katten die lijden aan artrose of gewrichtsslijtage. Bevat UC-II¬Æ collageen.",
                admin: "<strong>Kat.</strong> 1 kauwbrok per dag, ongeacht het gewicht.",
                warning: null,
                tomCoUrl: null
            },
            {
                id: 'flexadin_cat',
                name: "FLEXADIN CAT 60PC",
                isPurviso: false,
                brand: "Flexadin",
                category: "Supplements",
                need: ['articulations'],
                level: ['prevention'],
                species: ['kat'],
                age: ['adulte', 'senior'],
                objective: "Voedingssupplement voor de gewrichtssoepelheid bij katten (preventief).",
                admin: "<strong>Kat.</strong> <br><strong>< 6 kg:</strong> 1/dag. <br><strong>> 6 kg:</strong> 2/dag.",
                warning: null,
                tomCoUrl: null
            },
            {
                id: 'seraquin_omega_chat',
                name: "Seraquin Omega Kat 60 tabletten",
                isPurviso: false,
                brand: "Seraquin",
                category: "Supplements",
                need: ['articulations'],
                level: ['prevention', 'advanced'],
                species: ['kat'],
                age: ['adulte', 'senior'],
                objective: "Ondersteunt de gewrichten van katten (preventief of bewezen artrose). Verrijkt met kurkuma en omega-3.",
                admin: "<strong>Kat.</strong> <br><strong>Tot 5 kg:</strong> 2/dag. <br><strong>5-7,5 kg:</strong> 3/dag. <br><strong>7,5-10 kg:</strong> 4/dag.",
                warning: "Onderhoudsdosering = de helft van de startdosis na 4-6 weken.",
                tomCoUrl: null
            },
            // Spijsvertering
            {
                id: 'purviso_digestive_comfort',
                name: "Purviso Plus Digestive Comfort (poeder)",
                isPurviso: true,
                brand: "Purviso",
                category: "Supplements",
                need: ['digestion'],
                level: ['prevention'],
                species: ['hond', 'kat'],
                age: ['adulte', 'senior'], // "vanaf 4 maanden"
                objective: "Globaal Evenwicht van het Microbiota. Poeder (pre-, pro-, postbiotica). Helpt de transit te reguleren en vermindert haarballen bij de kat.",
                admin: "<strong>Volwassen katten en honden vanaf 4 maanden.</strong> 1 maatlepel per 10 kg lichaamsgewicht. Minimaal 14 dagen geven.",
                warning: "Alternatief voor Purina Fortiflora, Canikur Pro.",
                tomCoUrl: null
            },
            {
                id: 'purviso_pro_flora',
                name: "Purviso Plus Pro Flora 60 kauwbrokjes",
                isPurviso: true,
                brand: "Purviso",
                category: "Supplements",
                need: ['digestion'],
                level: ['advanced'],
                species: ['hond', 'kat'],
                age: ['adulte', 'senior'], // "vanaf 4 maanden"
                objective: "Aanvullend diervoeder voor honden dat de spijsvertering en de darmflora ondersteunt. Pro-, pro- en postbiotica herstellen de darmflora. Ondersteunt de spijsvertering. Geen kunstmatige kleuren of smaken. Alternatief voor Purina Fortiflora, Canikur Pro ",
                admin: "<strong>Volwassen katten en honden vanaf 4 maanden.</strong> 1 brok per 10 kg lichaamsgewicht. Minimaal 5 dagen geven. Vereist geen water.",
                warning: null, 
                tomCoUrl: null
            },
            {
                id: 'purviso_anal_glands',
                name: "Purviso Plus Anal Glands 90 kauwbrokjes",
                isPurviso: true,
                brand: "Purviso",
                category: "Supplements",
                need: ['digestion'],
                level: ['prevention'],
                species: ['hond'],
                age: ['adulte', 'senior'], // "vanaf 4 maanden"
                objective: "Ondersteuning Anale Klieren. Pompoenvezels, spijsverteringsenzymen en prebiotica. Helpt de anale klieren op natuurlijke wijze te legen.",
                admin: "<strong>Hond vanaf 4 maanden.</strong> <br><strong>< 10 kg:</strong> 1/dag. <br><strong>> 10 kg:</strong> 2/dag.",
                warning: "Alternatief voor Glandex, Vet-Comfort Glandes Anal.",
                tomCoUrl: null
            },
            {
                id: 'fortiflora_chat',
                name: "FortiFlora Kat (30 zakjes)",
                isPurviso: false,
                brand: "Purina",
                category: "Supplements",
                need: ['digestion'],
                level: ['prevention', 'advanced'],
                species: ['kat'],
                age: ['jeune', 'adulte', 'senior'],
                objective: "Probiotisch supplement voor katten. Helpt bij het beheersen van diarree en stress. Versterkt het immuunsysteem.",
                admin: "<strong>Kat.</strong> 1 zakje per dag. Strooien over het voer.",
                warning: "Alternatief als huismerk = Purviso Plus Digestive Comfort (poeder).",
                tomCoUrl: null
            },
            {
                id: 'fortiflora_chien',
                name: "FortiFlora Hond (30 zakjes)",
                isPurviso: false,
                brand: "Purina",
                category: "Supplements",
                need: ['digestion'],
                level: ['prevention', 'advanced'],
                species: ['hond'],
                age: ['jeune', 'adulte', 'senior'],
                objective: "Probiotisch supplement voor honden. Helpt bij het beheersen van diarree en stress. Versterkt het immuunsysteem.",
                admin: "<strong>Hond.</strong> 1 zakje per dag. Strooien over het voer.",
                warning: "Alternatief als huismerk = Purviso Plus Digestive Comfort (poeder).",
                tomCoUrl: null
            },
            // Huid en Vacht (Supplementen)
            {
                id: 'purviso_skin_hair',
                name: "Purviso Plus Skin & Hair 90 kauwbrokjes",
                isPurviso: true,
                brand: "Purviso",
                category: "Supplements",
                need: ['skin_supplement'],
                level: ['prevention'],
                species: ['hond', 'kat'],
                age: ['adulte', 'senior'], // "vanaf 4 maanden"
                objective: "Glanzende Vacht en Vermindering van de Rul. Geconcentreerde Omega 3 & 6 (lijnzaad-, teunisbloemolie). Helpt bij een droge huid en jeuk.",
                admin: "<strong>Volwassen kat en hond vanaf 4 maanden.</strong> <br><strong>Dosering:</strong> 1 brok per 10 kg lichaamsgewicht.",
                warning: "Alternatief voor Megaderm, Dermoscent Essential 6.",
                tomCoUrl: null
            },
            {
                id: 'dermoscent_essential_6',
                name: "Dermoscent Essential 6 Spot-On",
                isPurviso: false,
                brand: "Dermoscent",
                category: "Supplements",
                need: ['skin_supplement'],
                level: ['prevention'],
                species: ['hond', 'kat'],
                age: ['jeune', 'adulte', 'senior'],
                objective: "Wekelijkse Spot-on rijk aan essenti√´le vetzuren. Herstelt de barri√®refunctie van de huid, vermindert haaruitval en bestrijdt slechte geuren.",
                admin: "<strong>Kat en Hond (volgens grootte).</strong> 1 pipet per week gedurende 2 maanden (start), daarna 1 pipet om de 2 weken (onderhoud).",
                warning: "Het dier niet wassen gedurende 48 uur. Alternatief als huismerk = Purviso Plus Skin & Hair.",
                tomCoUrl: null
            },
            {
                id: 'epato_omega',
                name: "Epato Plus Omega 3 & 6",
                isPurviso: false,
                brand: "Epato",
                category: "Supplements",
                need: ['skin_supplement'],
                level: ['prevention', 'advanced'],
                species: ['hond', 'kat'],
                age: ['jeune', 'adulte', 'senior'],
                objective: "Supplement van visoli√´n (Omega 3 & 6) ter ondersteuning van de huid, de vacht en het immuunsysteem.",
                admin: "<strong>Kat en Hond (volgens gewicht).</strong> Zie de dosering op de verpakking.",
                warning: null,
                tomCoUrl: null
            },
            // Puppy en Kitten
            {
                id: 'kitty_stim',
                name: "Kitty Stim 15 ml",
                isPurviso: false,
                brand: "Kitty Stim",
                category: "Supplements",
                need: ['puppy_kitten', 'recovery'],
                level: ['advanced'],
                species: ['kat'],
                age: ['jeune'],
                objective: "Groeipasta voor kittens (vanaf 2 dagen). Stimuleert de eetlust, vitaliteit en weerstand. Voor zwakke kittens of kittens in moeilijkheden.",
                admin: "<strong>Kitten (vanaf 2 dagen).</strong> 0,1 ml per dag gedurende 5 dagen, daarna 0,1 ml per week tot 6 weken.",
                warning: "Raadpleeg uw dierenarts in geval van langdurige zwakte.",
                tomCoUrl: null
            },
            {
                id: 'puppy_stim',
                name: "Puppy Stim 15 ml",
                isPurviso: false,
                brand: "Puppy Stim",
                category: "Supplements",
                need: ['puppy_kitten', 'recovery'],
                level: ['advanced'],
                species: ['hond'],
                age: ['jeune'],
                objective: "Groeipasta voor puppy's (vanaf 2 dagen). Stimuleert de eetlust, vitaliteit en weerstand. Voor zwakke puppy's of puppy's in moeilijkheden.",
                admin: "<strong>Puppy (vanaf 2 dagen).</strong> 0,1 ml per dag gedurende 5 dagen, daarna 0,1 ml per week tot 6 weken.",
                warning: "Raadpleeg uw dierenarts in geval van langdurige zwakte.",
                tomCoUrl: null
            },
            // --- VERZORGINGSPRODUCTEN ---
            // Mondhygi√´ne
            {
                id: 'purviso_dental_spray',
                name: "Purviso Care Dental Spray",
                isPurviso: true,
                brand: "Purviso",
                category: "Soins",
                need: ['hygiene_dental'],
                level: ['prevention'],
                species: ['hond', 'kat'],
                age: ['jeune', 'adulte', 'senior'], // "vanaf 3 maanden"
                objective: "Frisse Adem en Anti-Plaque. Neutraliseert slechte adem en voorkomt tandsteen. Bevat munt en peterselie.",
                admin: "<strong>Hond en kat vanaf 3 maanden.</strong>",
                warning: "Alternatief voor Vet-Aquadent, Proden Plaque Off.",
                tomCoUrl: null
            },
            {
                id: 'virbac_logic',
                name: "Virbac Logic Di√©tal (Klein en Groot)",
                isPurviso: false,
                brand: "Virbac",
                category: "Soins",
                need: ['hygiene_dental'],
                level: ['prevention'],
                species: ['hond', 'kat'],
                age: ['jeune', 'adulte', 'senior'],
                objective: "Dagelijks tandpoeder om door het voer te mengen. Vermindert tandsteen, bestrijdt tandplak en verfrist de adem.",
                admin: "<strong>Hond en kat (volgens grootte).</strong> 1 √† 4 maatlepels per dag.",
                warning: null,
                tomCoUrl: null
            },
            {
                id: 'plaqtiv_wipes',
                name: "Plaqtiv Wipes 50 stuks",
                isPurviso: false,
                brand: "Plaqtiv",
                category: "Soins",
                need: ['hygiene_dental'],
                level: ['prevention'],
                species: ['hond', 'kat'],
                age: ['jeune', 'adulte', 'senior'],
                objective: "Tanddoekjes voor een gemakkelijke reiniging van de tanden en het tandvlees. Helpt gingivitis te voorkomen. Verwijdert tandplak.",
                admin: "<strong>Honden en katten.</strong> Wrijf dagelijks over de tanden en het tandvlees. Gebruik elke dag een nieuw doekje.",
                warning: null,
                tomCoUrl: null
            },
            {
                id: 'plaqtiv_spray',
                name: "Plaqtiv Spray buccal voor honden 60 ml",
                isPurviso: false,
                brand: "Plaqtiv",
                category: "Soins",
                need: ['hygiene_dental'],
                level: ['prevention'],
                species: ['hond'],
                age: ['jeune', 'adulte', 'senior'],
                objective: "Spray voor de mondhygi√´ne van honden. Vermindert tandplak en verfrist de adem. Goede aanvulling als poetsen onmogelijk is.",
                admin: "<strong>Hond.</strong> Dagelijks verstuiven (2x aan elke kant) direct op de tanden en het tandvlees.",
                warning: null,
                tomCoUrl: null
            },
            {
                id: 'orozyme_dentifrice',
                name: "Orozyme Enzymatische tandpasta 70 g",
                isPurviso: false,
                brand: "Orozyme",
                category: "Supplements", // Classification erron√©e, devrait √™tre 'Soins' maar maintenu 'Supplements' voor ne pas rompre la structure 'category'
                need: ['hygiene_dental'],
                level: ['prevention'],
                species: ['hond', 'kat'],
                age: ['jeune', 'adulte', 'senior'],
                objective: "Smakelijke tandpasta (hypoallergeen) voor gezonde tanden en tandvlees. Enzymatisch complex voorkomt tandplak, tandsteen en slechte adem.",
                admin: "<strong>Honden en katten.</strong> Poets de tanden dagelijks. <br><strong><20 kg en katten:</strong> 1 cm pasta. <br><strong>> 20 kg:</strong> 2 cm pasta.",
                warning: "Mag veilig worden ingeslikt. Niet naspoelen.",
                tomCoUrl: null
            },
            // Oog
            {
                id: 'ocryl_oplossing',
                name: "OCRYL OPLOSSING 135 ML",
                isPurviso: false,
                brand: "Ocryl",
                category: "Soins",
                need: ['hygiene_eyes'],
                level: ['prevention'],
                species: ['hond', 'kat', 'rongeur'], // + paarden, reptielen
                age: ['jeune', 'adulte', 'senior'],
                objective: "Zachte reinigingsoplossing (pH identiek aan tranen) voor de ogen en oogleden. Verwijdert stof, korstjes en sporen van tranen.",
                admin: "<strong>Honden, katten, paarden, knaagdieren, reptielen.</strong> Rechtstreeks in het oog of op een kompres aanbrengen.",
                warning: "Geschikt om het oog voor te bereiden v√≥√≥r het aanbrengen van druppels.",
                tomCoUrl: null
            },
            {
                id: 'otostan_oplossing',
                name: "Otostan Oplossing 100 ml",
                isPurviso: false,
                brand: "Otostan",
                category: "Soins",
                need: ['hygiene_ears'],
                level: ['prevention'],
                species: ['hond', 'kat'],
                age: ['jeune', 'adulte', 'senior'],
                objective: "Milde oplossing voor het regelmatig reinigen van de oren en het oplossen van oorsmeer. Helpt bij de preventie van oorontsteking.",
                admin: "<strong>Hond en kat.</strong> Aanbrengen 1 √† 2 keer per week. Masseer de basis van het oor. Kan de huid voorbereiden op een lokale behandeling.",
                warning: null,
                tomCoUrl: null
            },
            {
                id: 'epi_otic_solution',
                name: "Epi-Otic Solution 125 ml",
                isPurviso: false,
                brand: "Virbac",
                category: "Soins",
                need: ['hygiene_ears'],
                level: ['advanced'],
                species: ['hond', 'kat'],
                age: ['jeune', 'adulte', 'senior'],
                objective: "Krachtige oplossing voor het reinigen van de gehoorgang. Helpt bij de behandeling van oorontsteking. Verwijdert oorsmeer, korstjes, vuil en geuren.",
                admin: "<strong>Hond en kat.</strong> Aanbrengen 1 √† 2 keer per dag gedurende 2 weken. Onderhoudsdosis: 1 keer per week. Na 1 minuut inmasseren, verwijder de oplossing met een droge doek. Vermijd contact met de ogen.",
                warning: null,
                tomCoUrl: null
            },
            // Huid en Vacht (Verzorging)
            {
                id: 'purviso_ear_cleanser',
                name: "Purviso Care Ear Cleanser 100 ml",
                isPurviso: true,
                brand: "Purviso",
                category: "Soins",
                need: ['hygiene_ears'],
                level: ['prevention'],
                species: ['hond', 'kat'],
                age: ['jeune', 'adulte', 'senior'], // "vanaf 3 maanden"
                objective: "Milde Oorreiniger. Oplossing voor het regelmatig reinigen van de oren en het oplossen van oorsmeer. Helpt bij de preventie van oorontsteking.",
                admin: "<strong>Hond en kat vanaf 3 maanden.</strong> Aanbrengen 1 √† 2 keer per week.",
                warning: "Alternatief voor Otostan, Virbac Epi-Otic.",
                tomCoUrl: null
            },
            {
                id: 'purviso_eye_cleanser',
                name: "Purviso Care Eye Cleanser 100 ml",
                isPurviso: true,
                brand: "Purviso",
                category: "Soins",
                need: ['hygiene_eyes'],
                level: ['prevention'],
                species: ['hond', 'kat', 'rongeur'],
                age: ['jeune', 'adulte', 'senior'], // "vanaf 3 maanden"
                objective: "Milde Oogreiniger. Reinigende oplossing voor de ogen en de oogleden. Verwijdert stof en sporen van tranen. Zachte formule (pH neutraal).",
                admin: "<strong>Hond en kat vanaf 3 maanden.</strong> Aanbrengen op een kompres. Kan dagelijks worden gebruikt.",
                warning: "Alternatief voor Ocryl.",
                tomCoUrl: null
            },
            {
                id: 'purviso_calm_shampoo',
                name: "Purviso Care Calm Shampoo 200 ml",
                isPurviso: true,
                brand: "Purviso",
                category: "Soins",
                need: ['skin_care'],
                level: ['advanced'],
                species: ['hond', 'kat'],
                age: ['jeune', 'adulte', 'senior'], // "vanaf 3 maanden"
                objective: "Milde Verzachtende Shampoo. Helpt bij droge huid, roodheid en irritatie. Bevat havermout en alo√´ vera. Hydrateert en kalmeert.",
                admin: "<strong>Hond en kat vanaf 3 maanden.</strong> Masseer en laat 5 minuten inwerken. Spoel grondig.",
                warning: "Alternatief voor Allermyl, Sebocalm.",
                tomCoUrl: null
            },
            {
                id: 'purviso_universal_shampoo',
                name: "Purviso Care Universal Shampoo 200 ml",
                isPurviso: true,
                brand: "Purviso",
                category: "Soins",
                need: ['skin_care'],
                level: ['prevention'],
                species: ['hond', 'kat'],
                age: ['jeune', 'adulte', 'senior'], // "vanaf 3 maanden"
                objective: "Milde Dagelijkse Shampoo. Voor frequent wassen en glanzende vacht. Bevat arganolie en provitamine B5. Voor een zachte en glanzende vacht.",
                admin: "<strong>Hond en kat vanaf 3 maanden.</strong> Masseer en spoel direct. Kan regelmatig gebruikt worden.",
                warning: "Alternatief voor Virbac Allermyl, Dermoscent Atop 7.",
                tomCoUrl: null
            },
            {
                id: 'dermoscent_pipi_stop',
                name: "Dermoscent Pipi Stop Spray 100 ml",
                isPurviso: false,
                brand: "Dermoscent",
                category: "Soins",
                need: ['hygiene_ears'], // Mismatch - this is Pipi Stop, not ears
                level: ['prevention'],
                species: ['hond', 'kat'],
                age: ['jeune', 'adulte', 'senior'],
                objective: "Reinigings-/Ontgeuringsmiddel voor huisdierenurine. Elimineert geuren en voorkomt herhaaldelijk urineren op dezelfde plaats. (Niet op het dier gebruiken).",
                admin: "<strong>Hond en kat.</strong> Verstuif op de te reinigen plek. Laat drogen. Veeg indien nodig af.",
                warning: null,
                tomCoUrl: null
            },
            // Wonden en Pootjes
            {
                id: 'purviso_wound_gel',
                name: "Purviso Care Wound Gel 50 ml",
                isPurviso: true,
                brand: "Purviso",
                category: "Soins",
                need: ['wounds'],
                level: ['advanced'],
                species: ['hond', 'kat'],
                age: ['jeune', 'adulte', 'senior'], // "vanaf 3 maanden"
                objective: "Herstellende Wondgel. Helpt bij de genezing van oppervlakkige wonden. Beschermt tegen bacteri√´n. Bevat hyaluronzuur en zink.",
                admin: "<strong>Hond en kat vanaf 3 maanden.</strong> Aanbrengen 2 keer per dag op de gereinigde wond.",
                warning: "Alternatief voor Flamigel, Dermiel.",
                tomCoUrl: null
            },
            {
                id: 'purviso_paw_cream',
                name: "Purviso Care Paw Cream 50 ml",
                isPurviso: true,
                brand: "Purviso",
                category: "Soins",
                need: ['wounds'],
                level: ['prevention'],
                species: ['hond', 'kat'],
                age: ['jeune', 'adulte', 'senior'], // "vanaf 3 maanden"
                objective: "Beschermende Pootjescr√®me. Hydrateert en beschermt kussentjes tegen hitte, ijs of zout. Helpt kloven te genezen.",
                admin: "<strong>Hond en kat vanaf 3 maanden.</strong> Masseer op de kussentjes voor het wandelen of bij irritatie.",
                warning: "Alternatief voor Dermoscent Podo-Care.",
                tomCoUrl: null
            },
        ];

        // --- VERTALINGEN EN TAALINSTELLINGEN ---

        const DEFAULT_PRODUCT_TRANSLATIONS = {
            fr: {
                vetoquinol_calculs: {
                    objective: "Compl√©ment alimentaire pour chiens et chats sujets √† la formation de calculs/cristaux urinaires. Aide √† dissoudre les calculs urinaires (struvite).",
                    admin: "<strong>Chiens et chats.</strong> √Ä administrer quotidiennement. Directement dans la bouche ou m√©lang√© √† l‚Äôaliment/eau de boisson.<br><strong>Chats :</strong> ¬Ω √† 1 cuill√®re √† caf√© (3 √† 6 g) 2 √† 3 fois par jour.<br><strong>Chiens :</strong> ¬Ω √† 3 cuill√®res √† caf√© 2 √† 3 fois/jour.<br><strong>Dur√©e :</strong> maximum 6 mois.",
                    warning: "Il est recommand√© de consulter un v√©t√©rinaire avant utilisation."
                },
                dermoscent_uti_zen: {
                    objective: "Compl√©ment alimentaire de soutien des voies urinaires. Contient de l‚Äôextrait de cranberry. Peut √™tre administr√© pendant le traitement et aide √† pr√©venir les r√©cidives.",
                    admin: "<strong>Chien et chat.</strong> Administrer une fois par jour.<br><strong>0-10 kg :</strong> ¬Ω comprim√©/jour.<br><strong>10-20 kg :</strong> 1 comprim√©/jour.<br><strong>20-40 kg :</strong> 2 comprim√©s/jour.",
                    warning: "Une administration r√©guli√®re et continue est recommand√©e pour un r√©sultat optimal."
                },
                epato_pate: {
                    objective: "Prot√®ge le foie et restaure la fonction h√©patique du chat. Pour les chats souffrant d‚Äôune affection h√©patique ou suivant un traitement m√©dicamenteux.",
                    admin: "<strong>Chat.</strong> Une fois par jour, m√©lang√© √† l‚Äôaliment ou directement dans la bouche.<br><strong>Dosage :</strong> 1 ml par 5 kg de poids corporel.",
                    warning: "Consultez votre v√©t√©rinaire avant utilisation. Une administration quotidienne d‚Äôau moins 30 jours est recommand√©e."
                },
                vetoquinol_energie: {
                    objective: "Apport √©nerg√©tique suppl√©mentaire. Soutient pendant la convalescence/maladie, l‚Äôeffort physique intense et la croissance. Aide en cas de perte d‚Äôapp√©tit.",
                    admin: "<strong>Chiens et chats, tout √¢ge.</strong> Quotidien.<br><strong>Chiens (par 10 kg) :</strong> 1 cuill√®re √† soupe (18 g)/jour.<br><strong>Chats (par 3-5 kg) :</strong> 1 cuill√®re √† caf√© (6 g)/jour.",
                    warning: null
                },
                lysine_mp: {
                    objective: "Compl√©ment alimentaire pour chats dont le syst√®me immunitaire est affaibli. Soutient pendant les p√©riodes de stress, maladie ou effort. Adapt√© en cas de herpesvirus.",
                    admin: "<strong>Chat.</strong><br><strong>Chatons :</strong> 1 √† 2 g√©lules/jour.<br><strong>Chats :</strong> 1 √† 2 g√©lules matin et soir.",
                    warning: "√Ä administrer directement ou √† saupoudrer sur l‚Äôaliment."
                },
                dermoscent_senior: {
                    objective: "Spot-on pour soutenir la peau et le pelage des animaux √¢g√©s. Contient des antioxydants, hydrate et redonne de la souplesse. Apporte plus de vitalit√©.",
                    admin: "<strong>Chat et chien (selon la taille).</strong> 1 pipette par semaine pendant 2 mois, puis 1 pipette toutes les 2 semaines (entretien).",
                    warning: "√âcarter le pelage et appliquer entre les omoplates. Ne pas laver l‚Äôanimal pendant 48 h."
                },
                purviso_relax: {
                    objective: "Calme et s√©r√©nit√©. Formul√© avec Œ±-casoz√©pine et L-th√©anine. Aide √† g√©rer le stress (voyages, bruits, changements).",
                    admin: "<strong>Chat et chien adultes √† partir de 4 mois.</strong><br><strong>Posologie :</strong> 1 bouch√©e par 10 kg de poids corporel.",
                    warning: "Alternative √† Zylk√®ne, Sativavet."
                },
                zylkene_chew: {
                    objective: "Comprim√©s √† m√¢cher pour chiens afin de r√©duire le stress (feux d‚Äôartifice, voyages, visite chez le v√©t√©rinaire, anxi√©t√© de s√©paration, etc.). Contient de l‚ÄôŒ±-casoz√©pine.",
                    admin: "<strong>Chiens.</strong> Posologie variable selon le poids (voir emballage).<br><strong><10 kg :</strong> <5 kg = 1/jour, 5-10 kg = 2/jour.<br><strong>10-30 kg :</strong> 10-15 kg = 1/jour, 15-30 kg = 2/jour.<br><strong>15-60 kg :</strong> 15-30 kg = 1/jour, 30-60 kg = 2/jour.<br><strong>Remarque :</strong> la posologie officielle correspond √† celle indiqu√©e sur l‚Äôemballage. Ces valeurs sont des rep√®res g√©n√©raux.",
                    warning: "Commencer 1 √† 2 jours avant l‚Äô√©v√©nement stressant. Alternative marque propre : Purviso Plus Relax."
                },
                anibidiol_nature: {
                    objective: "Compl√©ment √† base d‚Äôhuile de chanvre et de CBD. Favorise le bien-√™tre, le comportement et la relaxation. Soutient le syst√®me nerveux et la vitalit√©.",
                    admin: "<strong>Chien et chat.</strong> Voie orale, quotidiennement.<br><strong>5 kg :</strong> 1 √† 4 capsules/jour.<br><strong>10 kg :</strong> 1 √† 8 capsules/jour.<br><strong>15 kg :</strong> 1 √† 12 capsules/jour.<br><strong>20 kg :</strong> 2 √† 16 capsules/jour.",
                    warning: "Donner la capsule enti√®re ou son contenu. Cure d‚Äôau moins 5 semaines. <0,2 % de THC."
                },
                purviso_vitality: {
                    objective: "Multivitamines compl√®tes. Favorise la sant√© globale et renforce le syst√®me immunitaire. Contient plus de 20 vitamines et min√©raux.",
                    admin: "<strong>Chats et chiens adultes √† partir de 4 mois.</strong><br><strong>Posologie :</strong> 1 bouch√©e par 10 kg de poids corporel.",
                    warning: "Alternative √† Optiform, Viti5."
                },
                purviso_mobility_forte: {
                    objective: "R√©paration intensive. Cible l‚Äôarthrose avanc√©e. Contient du collag√®ne de type II non d√©natur√© et de la Boswellia Serrata.",
                    admin: "<strong>Chien √† partir de 4 mois.</strong><br><strong>< 20 kg :</strong> 1 bouch√©e/jour.<br><strong>> 20 kg :</strong> 2 bouch√©es/jour.",
                    warning: "Alternative √† Flexadin Advanced, Seraquin Omega."
                },
                purviso_mobility_support: {
                    objective: "Protection et souplesse. Id√©al en pr√©vention ou lors des premiers signes d‚Äôarthrose. Glucosamine, MSM et acide hyaluronique.",
                    admin: "<strong>Chien √† partir de 4 mois.</strong><br><strong>< 30 kg :</strong> 1 bouch√©e/jour.<br><strong>> 30 kg :</strong> 2 bouch√©es/jour.",
                    warning: "Alternative √† Flexadin Plus, Flexadin Adult."
                },
                flexadin_advanced_boswellia: {
                    objective: "Soutient la fonction articulaire des chiens souffrant d‚Äôarthrose ou d‚Äôost√©oarthrite. Contient UC-II¬Æ (collag√®ne de type II).",
                    admin: "<strong>Chien adulte.</strong> 1 bouch√©e par jour (quel que soit le poids).",
                    warning: "Alternative marque propre : Purviso Plus Mobility Forte."
                },
                flexadin_adult_dog: {
                    objective: "Compl√©ment pour chiens adultes et seniors (√† partir de 2 ans) destin√© √† soutenir les articulations (pr√©vention).",
                    admin: "<strong>Chien adulte et senior (d√®s 2 ans).</strong> 1 bouch√©e par jour (quel que soit le poids).",
                    warning: "Alternative marque propre : Purviso Plus Mobility Support."
                },
                flexadin_young_maxi: {
                    objective: "Compl√©ment pour chiots et jeunes chiens (6 mois √† 2 ans) de grande taille (>10 kg) pour soutenir les articulations.",
                    admin: "<strong>Chiots et jeunes chiens (6 mois √† 2 ans) > 10 kg.</strong><br><strong>10-30 kg :</strong> 1/jour.<br><strong>>30 kg :</strong> 2/jour.",
                    warning: "Alternative marque propre : Purviso Plus Mobility Support."
                },
                flexadin_young_mini: {
                    objective: "Compl√©ment pour chiots et jeunes chiens (6 mois √† 2 ans) de petite taille (<10 kg) pour soutenir les articulations.",
                    admin: "<strong>Chiots et jeunes chiens (6 mois √† 2 ans) < 10 kg.</strong><br><strong><6 kg :</strong> 1/jour.<br><strong>6-10 kg :</strong> 2/jour.",
                    warning: "Alternative marque propre : Purviso Plus Mobility Support."
                },
                seraquin_omega_chien: {
                    objective: "Soutient les articulations des chiens (jeunes en croissance rapide, chiens sportifs, arthrose av√©r√©e). Enrichi en curcuma et en om√©ga-3.",
                    admin: "<strong>Chien.</strong><br><strong><10 kg :</strong> 1/jour.<br><strong>10-20 kg :</strong> 2/jour.<br><strong>20-40 kg :</strong> 3/jour.<br><strong>>40 kg :</strong> 4/jour.",
                    warning: "Dose d‚Äôentretien = moiti√© de la dose initiale apr√®s 4 √† 6 semaines. Alternative marque propre : Purviso Plus Mobility Forte."
                },
                flexadin_advanced_chat: {
                    objective: "Soutient la fonction articulaire des chats souffrant d‚Äôarthrose ou d‚Äôusure articulaire. Contient du collag√®ne UC-II¬Æ.",
                    admin: "<strong>Chat.</strong> 1 bouch√©e par jour, quel que soit le poids.",
                    warning: null
                },
                flexadin_cat: {
                    objective: "Compl√©ment alimentaire pour la souplesse articulaire des chats (pr√©vention).",
                    admin: "<strong>Chat.</strong><br><strong>< 6 kg :</strong> 1/jour.<br><strong>> 6 kg :</strong> 2/jour.",
                    warning: null
                },
                seraquin_omega_chat: {
                    objective: "Soutient les articulations des chats (en pr√©vention ou arthrose av√©r√©e). Enrichi en curcuma et om√©ga-3.",
                    admin: "<strong>Chat.</strong><br><strong>Jusqu‚Äô√† 5 kg :</strong> 2/jour.<br><strong>5-7,5 kg :</strong> 3/jour.<br><strong>7,5-10 kg :</strong> 4/jour.",
                    warning: "Dose d‚Äôentretien = moiti√© de la dose initiale apr√®s 4 √† 6 semaines."
                },
                purviso_digestive_comfort: {
                    objective: "√âquilibre global du microbiote. Poudre (pr√©-, pro- et postbiotiques). Aide √† r√©guler le transit et diminue les boules de poils chez le chat.",
                    admin: "<strong>Chats et chiens adultes √† partir de 4 mois.</strong> 1 mesure par 10 kg de poids corporel. Administrer au minimum 14 jours.",
                    warning: "Alternative √† Purina Fortiflora, Canikur Pro."
                },
                purviso_pro_flora: {
                    objective: "Aliment compl√©mentaire pour chiens soutenant la digestion et la flore intestinale. Les pr√©-, pro- et postbiotiques restaurent la flore. Soutient la digestion. Sans colorants ni ar√¥mes artificiels. Alternative √† Purina Fortiflora, Canikur Pro.",
                    admin: "<strong>Chats et chiens adultes √† partir de 4 mois.</strong> 1 bouch√©e par 10 kg de poids corporel. Administrer au minimum 5 jours. Ne n√©cessite pas d‚Äôeau.",
                    warning: null
                },
                purviso_anal_glands: {
                    objective: "Soutien des glandes anales. Fibres de citrouille, enzymes digestives et pr√©biotiques. Aide √† vider naturellement les glandes anales.",
                    admin: "<strong>Chien √† partir de 4 mois.</strong><br><strong>< 10 kg :</strong> 1/jour.<br><strong>> 10 kg :</strong> 2/jour.",
                    warning: "Alternative √† Glandex, Vet-Comfort Glandes Anal."
                },
                fortiflora_chat: {
                    objective: "Compl√©ment probiotique pour chats. Aide √† g√©rer la diarrh√©e et le stress. Renforce le syst√®me immunitaire.",
                    admin: "<strong>Chat.</strong> 1 sachet par jour. Saupoudrer sur l‚Äôaliment.",
                    warning: "Alternative marque propre : Purviso Plus Digestive Comfort (poudre)."
                },
                fortiflora_chien: {
                    objective: "Compl√©ment probiotique pour chiens. Aide √† g√©rer la diarrh√©e et le stress. Renforce le syst√®me immunitaire.",
                    admin: "<strong>Chien.</strong> 1 sachet par jour. Saupoudrer sur l‚Äôaliment.",
                    warning: "Alternative marque propre : Purviso Plus Digestive Comfort (poudre)."
                },
                purviso_skin_hair: {
                    objective: "Pelage brillant et r√©duction de la mue. Om√©ga 3 & 6 concentr√©s (huile de lin, onagre). Aide en cas de peau s√®che et de d√©mangeaisons.",
                    admin: "<strong>Chats et chiens adultes √† partir de 4 mois.</strong><br><strong>Posologie :</strong> 1 bouch√©e par 10 kg de poids corporel.",
                    warning: "Alternative √† Megaderm, Dermoscent Essential 6."
                },
                dermoscent_essential_6: {
                    objective: "Spot-on hebdomadaire riche en acides gras essentiels. Restaure la barri√®re cutan√©e, r√©duit la chute de poils et lutte contre les mauvaises odeurs.",
                    admin: "<strong>Chat et chien (selon la taille).</strong> 1 pipette par semaine pendant 2 mois (attaque), puis 1 pipette toutes les 2 semaines (entretien).",
                    warning: "Ne pas laver l‚Äôanimal pendant 48 h. Alternative marque propre : Purviso Plus Skin & Hair."
                },
                epato_omega: {
                    objective: "Suppl√©ment d‚Äôhuiles de poisson (om√©ga 3 & 6) pour soutenir la peau, le pelage et le syst√®me immunitaire.",
                    admin: "<strong>Chat et chien (selon le poids).</strong> Voir le dosage indiqu√© sur l‚Äôemballage.",
                    warning: null
                },
                kitty_stim: {
                    objective: "P√¢te de croissance pour chatons (d√®s 2 jours). Stimule l‚Äôapp√©tit, la vitalit√© et les d√©fenses. Pour chatons faibles ou en difficult√©.",
                    admin: "<strong>Chaton (d√®s 2 jours).</strong> 0,1 ml par jour pendant 5 jours, puis 0,1 ml par semaine jusqu‚Äô√† 6 semaines.",
                    warning: "Consultez votre v√©t√©rinaire en cas de faiblesse prolong√©e."
                },
                puppy_stim: {
                    objective: "P√¢te de croissance pour chiots (d√®s 2 jours). Stimule l‚Äôapp√©tit, la vitalit√© et les d√©fenses. Pour chiots faibles ou en difficult√©.",
                    admin: "<strong>Chiot (d√®s 2 jours).</strong> 0,1 ml par jour pendant 5 jours, puis 0,1 ml par semaine jusqu‚Äô√† 6 semaines.",
                    warning: "Consultez votre v√©t√©rinaire en cas de faiblesse prolong√©e."
                },
                purviso_dental_spray: {
                    objective: "Haleine fra√Æche et anti-plaque. Neutralise la mauvaise haleine et pr√©vient le tartre. Contient menthe et persil.",
                    admin: "<strong>Chien et chat √† partir de 3 mois.</strong>",
                    warning: "Alternative √† Vet-Aquadent, Proden Plaque Off."
                },
                virbac_logic: {
                    objective: "Poudre dentaire quotidienne √† m√©langer √† l‚Äôaliment. R√©duit le tartre, lutte contre la plaque et rafra√Æchit l‚Äôhaleine.",
                    admin: "<strong>Chien et chat (selon la taille).</strong> 1 √† 4 mesures par jour.",
                    warning: null
                },
                plaqtiv_wipes: {
                    objective: "Lingettes dentaires pour un nettoyage facile des dents et des gencives. Aide √† pr√©venir la gingivite. √âlimine la plaque dentaire.",
                    admin: "<strong>Chiens et chats.</strong> Frotter quotidiennement les dents et les gencives. Utiliser une lingette propre chaque jour.",
                    warning: null
                },
                plaqtiv_spray: {
                    objective: "Spray d‚Äôhygi√®ne buccale pour chiens. R√©duit la plaque et rafra√Æchit l‚Äôhaleine. Bon compl√©ment quand le brossage est impossible.",
                    admin: "<strong>Chien.</strong> Pulv√©riser chaque jour (2 fois de chaque c√¥t√©) directement sur les dents et les gencives.",
                    warning: null
                },
                orozyme_dentifrice: {
                    objective: "Dentifrice app√©tent (hypoallerg√©nique) pour des dents et des gencives saines. Complexe enzymatique qui pr√©vient plaque, tartre et mauvaise haleine.",
                    admin: "<strong>Chiens et chats.</strong> Brosser les dents quotidiennement.<br><strong><20 kg et chats :</strong> 1 cm de p√¢te.<br><strong>> 20 kg :</strong> 2 cm de p√¢te.",
                    warning: "Peut √™tre aval√© en toute s√©curit√©. Ne pas rincer."
                },
                ocryl_oplossing: {
                    objective: "Solution nettoyante douce (pH identique aux larmes) pour les yeux et les paupi√®res. √âlimine poussi√®res, cro√ªtes et traces de larmes.",
                    admin: "<strong>Chiens, chats, chevaux, rongeurs, reptiles.</strong> Appliquer directement dans l‚Äô≈ìil ou sur une compresse.",
                    warning: "Permet de pr√©parer l‚Äô≈ìil avant l‚Äôinstillation de gouttes."
                },
                otostan_oplossing: {
                    objective: "Solution douce pour le nettoyage r√©gulier des oreilles et la dissolution du c√©rumen. Aide √† pr√©venir l‚Äôotite.",
                    admin: "<strong>Chien et chat.</strong> Appliquer 1 √† 2 fois par semaine. Masser la base de l‚Äôoreille. Peut pr√©parer la peau √† un traitement local.",
                    warning: null
                },
                epi_otic_solution: {
                    objective: "Solution puissante pour nettoyer le conduit auditif. Aide en cas d‚Äôotite. √âlimine c√©rumen, cro√ªtes, d√©bris et odeurs.",
                    admin: "<strong>Chien et chat.</strong> Appliquer 1 √† 2 fois par jour pendant 2 semaines. Entretien : 1 fois par semaine. Apr√®s 1 minute de massage, essuyer avec une compresse. √âviter le contact avec les yeux.",
                    warning: null
                },
                purviso_ear_cleanser: {
                    objective: "Nettoyant auriculaire doux. Solution pour le nettoyage r√©gulier des oreilles et la dissolution du c√©rumen. Aide √† pr√©venir l‚Äôotite.",
                    admin: "<strong>Chien et chat √† partir de 3 mois.</strong> Appliquer 1 √† 2 fois par semaine.",
                    warning: "Alternative √† Otostan, Virbac Epi-Otic."
                },
                purviso_eye_cleanser: {
                    objective: "Nettoyant oculaire doux. Solution pour les yeux et les paupi√®res. √âlimine poussi√®re et traces de larmes. Formule douce (pH neutre).",
                    admin: "<strong>Chien et chat √† partir de 3 mois.</strong> Appliquer sur une compresse. Peut √™tre utilis√© quotidiennement.",
                    warning: "Alternative √† Ocryl."
                },
                purviso_calm_shampoo: {
                    objective: "Shampooing apaisant doux. Aide en cas de peau s√®che, rougeurs et irritations. Contient avoine et aloe vera. Hydrate et apaise.",
                    admin: "<strong>Chien et chat √† partir de 3 mois.</strong> Masser et laisser agir 5 minutes. Rincer abondamment.",
                    warning: "Alternative √† Allermyl, Sebocalm."
                },
                purviso_universal_shampoo: {
                    objective: "Shampooing doux quotidien. Pour lavages fr√©quents et pelage brillant. Contient huile d‚Äôargan et provitamine B5. Pour un pelage doux et brillant.",
                    admin: "<strong>Chien et chat √† partir de 3 mois.</strong> Masser puis rincer imm√©diatement. Peut √™tre utilis√© r√©guli√®rement.",
                    warning: "Alternative √† Virbac Allermyl, Dermoscent Atop 7."
                },
                dermoscent_pipi_stop: {
                    objective: "Nettoyant/d√©sodorisant pour les urines d‚Äôanimaux. √âlimine les odeurs et √©vite les marquages r√©p√©t√©s au m√™me endroit. (Ne pas utiliser sur l‚Äôanimal.)",
                    admin: "<strong>Chien et chat.</strong> Vaporiser sur la zone √† traiter. Laisser s√©cher. Essuyer si n√©cessaire.",
                    warning: null
                },
                purviso_wound_gel: {
                    objective: "Gel cicatrisant. Aide √† la gu√©rison des plaies superficielles. Prot√®ge des bact√©ries. Contient acide hyaluronique et zinc.",
                    admin: "<strong>Chien et chat √† partir de 3 mois.</strong> Appliquer 2 fois par jour sur la plaie nettoy√©e.",
                    warning: "Alternative √† Flamigel, Dermiel."
                },
                purviso_paw_cream: {
                    objective: "Cr√®me protectrice pour coussinets. Hydrate et prot√®ge contre la chaleur, la glace ou le sel. Aide √† r√©parer les crevasses.",
                    admin: "<strong>Chien et chat √† partir de 3 mois.</strong> Masser sur les coussinets avant la promenade ou en cas d‚Äôirritation.",
                    warning: "Alternative √† Dermoscent Podo-Care."
                }
            }
        };

        let MASTER_PRODUCT_DATABASE = [];
        let PRODUCT_TRANSLATIONS = {};
        let SEARCH_CRITERIA = {};

        function initializeDataStores() {
            const loadedProducts = loadFromStorage(STORAGE_KEYS.products, DEFAULT_PRODUCT_DATABASE);
            const loadedTranslations = loadFromStorage(STORAGE_KEYS.translations, DEFAULT_PRODUCT_TRANSLATIONS);
            const loadedCriteria = loadFromStorage(STORAGE_KEYS.criteria, DEFAULT_SEARCH_CRITERIA);

            const { data: products, changed: productsChanged } = ensureProductDataStructure(loadedProducts, DEFAULT_PRODUCT_DATABASE);
            const { data: translations, changed: translationsChanged } = ensureTranslationStructure(loadedTranslations, DEFAULT_PRODUCT_TRANSLATIONS);
            const { data: criteria, changed: criteriaChanged } = ensureCriteriaStructure(loadedCriteria, DEFAULT_SEARCH_CRITERIA);

            MASTER_PRODUCT_DATABASE = products;
            PRODUCT_TRANSLATIONS = translations;
            if (!PRODUCT_TRANSLATIONS.fr) {
                PRODUCT_TRANSLATIONS.fr = {};
            }
            SEARCH_CRITERIA = criteria;

            if (productsChanged) {
                saveToStorage(STORAGE_KEYS.products, MASTER_PRODUCT_DATABASE);
            }
            if (translationsChanged) {
                saveToStorage(STORAGE_KEYS.translations, PRODUCT_TRANSLATIONS);
            }
            if (criteriaChanged) {
                saveToStorage(STORAGE_KEYS.criteria, SEARCH_CRITERIA);
            }
        }

        initializeDataStores();

        const LANGUAGE_DATA = {
            nl: {
                htmlLang: 'nl',
                pageTitle: 'Strategie & Catalogus Paracorner Dierenarts',
                texts: {
                    headerTitle: 'Strategie & Catalogus Paracorner Dierenarts',
                    headerSubtitle: 'Versterk de veterinaire expertise en het onderscheid met het huismerk Purviso.',
                    searchAccordionTitle: 'Zoeken & Aanbeveling (inklapbaar)',
                    searchIntro: 'Selecteer de specifieke criteria van het dier. De tool <strong>geeft voorrang aan Purviso‚Äëproducten</strong> en toont andere compatibele alternatieven.',
                    speciesLabel: 'A. Soort',
                    speciesPlaceholder: 'Soort kiezen',
                    speciesOptionDog: 'üê∂ Hond',
                    speciesOptionCat: 'üê± Kat',
                    speciesOptionRodent: 'üê∞ Knaagdier / Klein Zoogdier',
                    ageLabel: 'B. Leeftijdscategorie',
                    agePlaceholder: 'Leeftijd kiezen',
                    ageOptionYoung: 'Jong (Groei / Puppy / Kitten)',
                    ageOptionAdult: 'Volwassen (Volledige maturiteit)',
                    ageOptionSenior: 'Senior (Gevorderde leeftijd)',
                    needLabel: 'C. Wat is de hoofdbehoefte?',
                    needPlaceholder: 'Categorie kiezen',
                    needOptionArticulations: 'ü¶¥ Gewrichten',
                    needOptionDigestion: 'ü¶† Spijsvertering & Anaalklieren',
                    needOptionSkinCare: 'üßº Huid & Vacht (Verzorging)',
                    needOptionSkinSupplement: '‚ú® Huid & Vacht (Supplement)',
                    needOptionAnxiety: 'üßò Angst & Stress',
                    needOptionDental: 'ü¶∑ Mondhygi√´ne',
                    needOptionEyes: 'üëÅÔ∏è Ooghygi√´ne',
                    needOptionEars: 'üëÇ Oorhygi√´ne',
                    needOptionWounds: 'ü©π Wonden & Pootjes',
                    needOptionUrinary: 'üíß Urinaire Weg',
                    needOptionLiver: 'üß° Lever',
                    needOptionRecovery: '‚è≥ Herstel & Vitaminen',
                    needOptionPuppyKitten: 'üêæ Puppy & Kitten',
                    levelLabel: 'D. Wat is de ernst van het probleem?',
                    levelPlaceholder: 'Ernst kiezen',
                    levelOptionPrevention: 'Licht / Preventie / Onderhoud',
                    levelOptionAdvanced: 'Gevorderd / Duidelijke symptomen / Intensief',
                    healthNotesLabel: 'E. Gezondheidsnotities (optioneel)',
                    healthNotesPlaceholder: 'Bijv.: Diabetes, bekende allergie...',
                    healthNotesHint: 'Als het dier een andere ernstige gezondheidskwestie heeft, <strong>adviseer altijd een dierenartsconsult</strong> v√≥√≥r de verkoop van een supplement.',
                    analyzeButton: 'Analyse en aanbeveling genereren',
                    resetButton: 'Criteria resetten',
                    supplementsHeading: '1. Opleidingscatalogus (Alle Supplementen)',
                    supplementsDescription: 'Volledige lijst van alle supplementen in het planogram, gegroepeerd per behoefte.',
                    careHeading: '2. Opleidingscatalogus (Alle Verzorgingsproducten)',
                    careDescription: 'Volledige lijst van alle verzorgingsproducten in het planogram, gegroepeerd per behoefte.',
                    footerText: 'Intern Strategisch Document - T&C Parafarmacie'
                },
                productMessages: {
                    error_species: 'Selecteer eerst een <strong>Soort</strong> (A).',
                    error_age: 'Selecteer de <strong>Leeftijdscategorie</strong> (B).',
                    error_need: 'Selecteer de <strong>Hoofdbehoefte</strong> (C).',
                    error_level: 'Selecteer de <strong>Ernst van het probleem</strong> (D).',
                    no_product: 'Er is geen product gevonden dat perfect overeenkomt met de geselecteerde criteria.',
                    recommendation_intro: 'Op basis van uw selectie wordt het volgende aanbevolen:',
                    alternative_intro: 'Andere compatibele alternatieven:',
                    purviso_priority: '<strong>Purviso Huismerk (Prioriteit)</strong>',
                    other_alternative: '<strong>Ander Compatibel Product</strong>',
                    notes_warning: 'Opmerking: Het veld \'Gezondheidsnotities\' is niet verwerkt door de selector, maar is een herinnering om <strong>altijd een dierenarts te raadplegen</strong> in geval van ernstige klachten.',
                    admin: 'Gebruik/Toediening:',
                    warning: 'Waarschuwing:',
                    objective: 'Doel:'
                },
                tagLabels: {
                    articulations: 'ü¶¥ Gewrichten',
                    digestion: 'ü¶† Spijsvertering & Anaalklieren',
                    skin_care: 'üßº Huid & Vacht (Verzorging)',
                    skin_supplement: '‚ú® Huid & Vacht (Supplement)',
                    anxiety: 'üßò Angst & Stress',
                    hygiene_dental: 'ü¶∑ Mondhygi√´ne',
                    hygiene_eyes: 'üëÅÔ∏è Ooghygi√´ne',
                    hygiene_ears: 'üëÇ Oorhygi√´ne',
                    wounds: 'ü©π Wonden & Pootjes',
                    urinary: 'üíß Urinaire Weg',
                    liver: 'üß° Lever',
                    recovery: '‚è≥ Herstel & Vitaminen',
                    puppy_kitten: 'üêæ Puppy & Kitten',
                    prevention: 'Licht / Preventie / Onderhoud',
                    advanced: 'Gevorderd / Duidelijke symptomen / Intensief'
                },
                catalog: {
                    groupCount: count => `${count} producten`,
                    purvisoTag: 'Huismerk'
                },
                modal: {
                    brand: 'Merk',
                    category: 'Categorie',
                    priority: 'Prioriteit',
                    categories: {
                        Supplements: 'Supplement',
                        Soins: 'Verzorging'
                    },
                    purviso: 'Huismerk (Prioriteit)',
                    external: 'Extern Merk'
                }
            },
            fr: {
                htmlLang: 'fr',
                pageTitle: 'Strat√©gie & Catalogue Paracorner V√©t√©rinaire',
                texts: {
                    headerTitle: 'Strat√©gie & Catalogue Paracorner V√©t√©rinaire',
                    headerSubtitle: 'Renforcez l‚Äôexpertise v√©t√©rinaire et la diff√©renciation avec la marque propre Purviso.',
                    searchAccordionTitle: 'Recherche & Recommandation (repliable)',
                    searchIntro: 'S√©lectionnez les crit√®res sp√©cifiques de l‚Äôanimal. L‚Äôoutil <strong>priorise les produits Purviso</strong> et affiche d‚Äôautres alternatives compatibles.',
                    speciesLabel: 'A. Esp√®ce',
                    speciesPlaceholder: 'Choisir une esp√®ce',
                    speciesOptionDog: 'üê∂ Chien',
                    speciesOptionCat: 'üê± Chat',
                    speciesOptionRodent: 'üê∞ Rongeur / Petit mammif√®re',
                    ageLabel: 'B. Tranche d‚Äô√¢ge',
                    agePlaceholder: 'Choisir l‚Äô√¢ge',
                    ageOptionYoung: 'Jeune (Croissance / Chiot / Chaton)',
                    ageOptionAdult: 'Adulte (Maturit√© compl√®te)',
                    ageOptionSenior: 'Senior (√Çge avanc√©)',
                    needLabel: 'C. Besoin principal ?',
                    needPlaceholder: 'Choisir une cat√©gorie',
                    needOptionArticulations: 'ü¶¥ Articulations',
                    needOptionDigestion: 'ü¶† Digestion & Glandes anales',
                    needOptionSkinCare: 'üßº Peau & Pelage (Soin)',
                    needOptionSkinSupplement: '‚ú® Peau & Pelage (Compl√©ment)',
                    needOptionAnxiety: 'üßò Anxi√©t√© & Stress',
                    needOptionDental: 'ü¶∑ Hygi√®ne bucco-dentaire',
                    needOptionEyes: 'üëÅÔ∏è Hygi√®ne oculaire',
                    needOptionEars: 'üëÇ Hygi√®ne auriculaire',
                    needOptionWounds: 'ü©π Plaies & Coussinets',
                    needOptionUrinary: 'üíß Voie urinaire',
                    needOptionLiver: 'üß° Foie',
                    needOptionRecovery: '‚è≥ R√©cup√©ration & Vitamines',
                    needOptionPuppyKitten: 'üêæ Chiot & Chaton',
                    levelLabel: 'D. Gravit√© du probl√®me ?',
                    levelPlaceholder: 'Choisir la gravit√©',
                    levelOptionPrevention: 'L√©ger / Pr√©vention / Entretien',
                    levelOptionAdvanced: 'Avanc√© / Sympt√¥mes marqu√©s / Intensif',
                    healthNotesLabel: 'E. Notes de sant√© (optionnel)',
                    healthNotesPlaceholder: 'Ex. : Diab√®te, allergie connue...',
                    healthNotesHint: 'Si l‚Äôanimal pr√©sente un autre probl√®me de sant√© s√©rieux, <strong>recommandez toujours une consultation v√©t√©rinaire</strong> avant la vente d‚Äôun compl√©ment.',
                    analyzeButton: 'G√©n√©rer l‚Äôanalyse et la recommandation',
                    resetButton: 'R√©initialiser les crit√®res',
                    supplementsHeading: '1. Catalogue de formation (Tous les compl√©ments)',
                    supplementsDescription: 'Liste compl√®te de tous les compl√©ments du planogramme, regroup√©s par besoin.',
                    careHeading: '2. Catalogue de formation (Tous les produits de soin)',
                    careDescription: 'Liste compl√®te de tous les produits de soin du planogramme, regroup√©s par besoin.',
                    footerText: 'Document strat√©gique interne ‚Äì T&C Parapharmacie'
                },
                productMessages: {
                    error_species: 'S√©lectionnez d‚Äôabord une <strong>Esp√®ce</strong> (A).',
                    error_age: 'S√©lectionnez la <strong>Tranche d‚Äô√¢ge</strong> (B).',
                    error_need: 'S√©lectionnez le <strong>Besoin principal</strong> (C).',
                    error_level: 'S√©lectionnez la <strong>Gravit√© du probl√®me</strong> (D).',
                    no_product: 'Aucun produit ne correspond exactement aux crit√®res s√©lectionn√©s.',
                    recommendation_intro: 'Sur la base de votre s√©lection, nous recommandons :',
                    alternative_intro: 'Autres alternatives compatibles :',
                    purviso_priority: '<strong>Purviso Marque Propre (Priorit√©)</strong>',
                    other_alternative: '<strong>Autre produit compatible</strong>',
                    notes_warning: 'Remarque : le champ ¬´ Notes de sant√© ¬ª n‚Äôest pas pris en compte par le s√©lecteur. Il rappelle de <strong>toujours recommander une consultation v√©t√©rinaire</strong> en cas de probl√®me s√©rieux.',
                    admin: 'Utilisation / Posologie :',
                    warning: 'Avertissement :',
                    objective: 'Objectif :'
                },
                tagLabels: {
                    articulations: 'ü¶¥ Articulations',
                    digestion: 'ü¶† Digestion & Glandes anales',
                    skin_care: 'üßº Peau & Pelage (Soin)',
                    skin_supplement: '‚ú® Peau & Pelage (Compl√©ment)',
                    anxiety: 'üßò Anxi√©t√© & Stress',
                    hygiene_dental: 'ü¶∑ Hygi√®ne bucco-dentaire',
                    hygiene_eyes: 'üëÅÔ∏è Hygi√®ne oculaire',
                    hygiene_ears: 'üëÇ Hygi√®ne auriculaire',
                    wounds: 'ü©π Plaies & Coussinets',
                    urinary: 'üíß Voie urinaire',
                    liver: 'üß° Foie',
                    recovery: '‚è≥ R√©cup√©ration & Vitamines',
                    puppy_kitten: 'üêæ Chiot & Chaton',
                    prevention: 'L√©ger / Pr√©vention / Entretien',
                    advanced: 'Avanc√© / Sympt√¥mes marqu√©s / Intensif'
                },
                catalog: {
                    groupCount: count => `${count} produits`,
                    purvisoTag: 'Marque propre'
                },
                modal: {
                    brand: 'Marque',
                    category: 'Cat√©gorie',
                    priority: 'Priorit√©',
                    categories: {
                        Supplements: 'Compl√©ment',
                        Soins: 'Soin'
                    },
                    purviso: 'Purviso (marque propre)',
                    external: 'Marque partenaire'
                }
            }
        };

        let currentLanguage = 'nl';

        function getLangData() {
            return LANGUAGE_DATA[currentLanguage];
        }

        function getLocalizedField(product, field) {
            if (!product) return '';
            const hasField = product && Object.prototype.hasOwnProperty.call(product, field);
            const baseValue = hasField && product[field] != null ? product[field] : '';
            if (currentLanguage === 'nl') {
                return baseValue;
            }

            const langTranslations = PRODUCT_TRANSLATIONS[currentLanguage] || {};
            const translationForProduct = langTranslations[product.id] || {};

            if (Object.prototype.hasOwnProperty.call(translationForProduct, field)) {
                return translationForProduct[field];
            }

            return baseValue;
        }

        function getCriteriaList(type) {
            const list = SEARCH_CRITERIA[type];
            return Array.isArray(list) ? list : [];
        }

        function getCriteriaLabel(type, value) {
            const option = getCriteriaList(type).find(item => item.value === value);
            if (!option) return null;
            const labels = option.labels && typeof option.labels === 'object' ? option.labels : {};
            return labels[currentLanguage] || labels.nl || value;
        }

        function getElementValue(id) {
            const element = document.getElementById(id);
            return element ? element.value : '';
        }

        function getElementChecked(id) {
            const element = document.getElementById(id);
            return element ? element.checked : false;
        }

        function configureSelect(selectId, type, placeholderKey) {
            const select = document.getElementById(selectId);
            if (!select) return;
            const previousValue = select.value;
            const langData = getLangData();
            const placeholderText = (langData && langData.texts && langData.texts[placeholderKey]) ? langData.texts[placeholderKey] : '';

            select.innerHTML = '';

            const placeholderOption = document.createElement('option');
            placeholderOption.value = '';
            placeholderOption.disabled = true;
            placeholderOption.selected = true;
            placeholderOption.textContent = placeholderText;
            select.appendChild(placeholderOption);

            getCriteriaList(type).forEach(option => {
                const opt = document.createElement('option');
                opt.value = option.value;
                const labels = option.labels && typeof option.labels === 'object' ? option.labels : {};
                opt.textContent = labels[currentLanguage] || labels.nl || option.value;
                select.appendChild(opt);
            });

            if (previousValue) {
                select.value = previousValue;
                if (select.value !== previousValue) {
                    select.selectedIndex = 0;
                }
            }
        }

        function renderSearchCriteria() {
            configureSelect('species', 'species', 'speciesPlaceholder');
            configureSelect('age', 'age', 'agePlaceholder');
            configureSelect('need', 'need', 'needPlaceholder');
            configureSelect('level', 'level', 'levelPlaceholder');
        }

        function refreshPublicViews() {
            fillCatalog('full-supplements-accordion', 'Supplements');
            fillCatalog('full-care-accordion', 'Soins');
            renderSearchCriteria();

            const messageDiv = document.getElementById('message');
            if (messageDiv && !messageDiv.classList.contains('hidden') && messageDiv.innerHTML.trim() !== '') {
                findProduct();
            }
        }

        let isBackOfficeAuthenticated = false;
        let activeBackOfficeTab = 'products';
        let selectedProductId = null;
        let productFeedbackTimer = null;
        let criteriaFeedbackTimer = null;
        let settingsFeedbackTimer = null;

        function openBackOfficeLogin() {
            const overlay = document.getElementById('backoffice-login');
            if (!overlay) return;
            overlay.classList.add('open');

            const input = document.getElementById('backoffice-code');
            const errorLabel = document.getElementById('backoffice-login-error');
            if (input) {
                input.classList.remove('input-error');
                input.value = '';
                setTimeout(() => input.focus(), 50);
            }
            if (errorLabel) {
                errorLabel.classList.add('hidden');
            }
        }

        function closeBackOfficeLogin() {
            const overlay = document.getElementById('backoffice-login');
            if (!overlay) return;
            overlay.classList.remove('open');
        }

        function handleBackOfficeAuth() {
            const input = document.getElementById('backoffice-code');
            const errorLabel = document.getElementById('backoffice-login-error');
            if (!input) return;

            const value = (input.value || '').trim();
            if (value === ACCESS_CODE) {
                isBackOfficeAuthenticated = true;
                input.value = '';
                input.classList.remove('input-error');
                if (errorLabel) {
                    errorLabel.classList.add('hidden');
                }
                closeBackOfficeLogin();
                openBackOfficePanel(activeBackOfficeTab);
            } else {
                input.value = '';
                input.classList.add('input-error');
                if (errorLabel) {
                    errorLabel.classList.remove('hidden');
                }
            }
        }

        function openBackOfficePanel(tab = 'products') {
            activeBackOfficeTab = tab;
            const overlay = document.getElementById('backoffice-panel');
            if (!overlay) return;
            overlay.classList.add('open');
            updateBackOfficeTabs();
            renderBackOfficeContent();
        }

        function closeBackOfficePanel() {
            const overlay = document.getElementById('backoffice-panel');
            if (!overlay) return;
            overlay.classList.remove('open');
        }

        function updateBackOfficeTabs() {
            document.querySelectorAll('#backoffice-panel .backoffice-tab').forEach(button => {
                const tab = button.getAttribute('data-tab');
                button.classList.toggle('active', tab === activeBackOfficeTab);
            });
        }

        function switchBackOfficeTab(tab) {
            if (activeBackOfficeTab === tab) return;
            activeBackOfficeTab = tab;
            updateBackOfficeTabs();
            renderBackOfficeContent();
        }

        function renderBackOfficeContent() {
            const container = document.getElementById('backoffice-content');
            if (!container) return;

            if (activeBackOfficeTab === 'criteria') {
                renderCriteriaTab(container);
            } else if (activeBackOfficeTab === 'settings') {
                renderSettingsTab(container);
            } else {
                renderProductsTab(container);
            }
        }

        function renderProductsTab(container) {
            container.innerHTML = `
                <div class="backoffice-grid two-columns">
                    <div class="backoffice-panel" id="bo-product-list-panel">
                        <h3>Catalogue produits</h3>
                        <input type="search" id="bo-product-search" class="w-full border border-gray-300 rounded-lg px-3 py-2" placeholder="Rechercher par nom, marque ou besoin..." />
                        <p class="backoffice-hint mt-2">Astuce : tapez un mot-cl√© pour filtrer la liste.</p>
                        <div class="backoffice-list mt-4" id="bo-product-list"></div>
                        <button type="button" class="btn-secondary w-full mt-4" id="bo-new-product">Nouveau produit</button>
                    </div>
                    <div class="backoffice-panel backoffice-form" id="bo-product-form-panel">
                        <h3>D√©tails produit</h3>
                        <div class="grid gap-4 md:grid-cols-2">
                            <label>Identifiant unique
                                <input type="text" id="bo-product-id" placeholder="ex : purviso_vitality" />
                            </label>
                            <label>Nom (NL)
                                <input type="text" id="bo-product-name" placeholder="Nom NL affich√©" />
                            </label>
                        </div>
                        <div class="grid gap-4 md:grid-cols-3 mt-4">
                            <label>Marque
                                <input type="text" id="bo-product-brand" placeholder="Purviso, Virbac..." />
                            </label>
                            <label>Cat√©gorie
                                <select id="bo-product-category">
                                    <option value="Supplements">Supplements</option>
                                    <option value="Soins">Soins</option>
                                </select>
                            </label>
                            <label>Lien Tom&Co (optionnel)
                                <input type="text" id="bo-product-link" placeholder="URL produit" />
                            </label>
                        </div>
                        <label class="inline-flex items-center gap-2 mt-4">
                            <input type="checkbox" id="bo-product-purviso" />
                            <span>Produit Purviso (prioritaire)</span>
                        </label>
                        <div class="grid gap-4 md:grid-cols-2 mt-4">
                            <div>
                                <p class="font-semibold text-sm text-gray-700 mb-2">Esp√®ces concern√©es</p>
                                <div class="backoffice-chip-group" id="bo-species-options"></div>
                            </div>
                            <div>
                                <p class="font-semibold text-sm text-gray-700 mb-2">Tranches d‚Äô√¢ge</p>
                                <div class="backoffice-chip-group" id="bo-age-options"></div>
                            </div>
                        </div>
                        <div class="grid gap-4 md:grid-cols-2 mt-4">
                            <div>
                                <p class="font-semibold text-sm text-gray-700 mb-2">Besoins cibl√©s</p>
                                <div class="backoffice-chip-group" id="bo-need-options"></div>
                            </div>
                            <div>
                                <p class="font-semibold text-sm text-gray-700 mb-2">Niveaux / gravit√©</p>
                                <div class="backoffice-chip-group" id="bo-level-options"></div>
                            </div>
                        </div>
                        <div class="grid gap-4 lg:grid-cols-2 mt-6">
                            <div class="space-y-3">
                                <p class="font-semibold text-sm text-gray-700 uppercase tracking-wide">Contenu NL</p>
                                <label>Objectif (NL)
                                    <textarea id="bo-nl-objective" placeholder="Objectif en n√©erlandais"></textarea>
                                </label>
                                <label>Utilisation / Posologie (NL)
                                    <textarea id="bo-nl-admin" placeholder="Instructions NL"></textarea>
                                </label>
                                <label>Avertissement (NL)
                                    <textarea id="bo-nl-warning" placeholder="Avertissement NL (optionnel)"></textarea>
                                </label>
                            </div>
                            <div class="space-y-3">
                                <p class="font-semibold text-sm text-gray-700 uppercase tracking-wide">Contenu FR</p>
                                <label>Objectif (FR)
                                    <textarea id="bo-fr-objective" placeholder="Objectif en fran√ßais"></textarea>
                                </label>
                                <label>Utilisation / Posologie (FR)
                                    <textarea id="bo-fr-admin" placeholder="Instructions FR"></textarea>
                                </label>
                                <label>Avertissement (FR)
                                    <textarea id="bo-fr-warning" placeholder="Avertissement FR (optionnel)"></textarea>
                                </label>
                            </div>
                        </div>
                        <div id="bo-product-feedback" class="mt-4 text-sm"></div>
                        <div class="backoffice-actions">
                            <button type="button" class="btn-danger hidden" id="bo-delete-product">Supprimer</button>
                            <button type="button" class="btn-primary" id="bo-save-product">Enregistrer</button>
                        </div>
                    </div>
                </div>
            `;

            const searchInput = document.getElementById('bo-product-search');
            if (searchInput) {
                searchInput.addEventListener('input', () => renderBackOfficeProductList());
            }

            const newButton = document.getElementById('bo-new-product');
            if (newButton) {
                newButton.addEventListener('click', () => {
                    selectedProductId = null;
                    renderBackOfficeProductList();
                    clearProductForm();
                    const idInput = document.getElementById('bo-product-id');
                    if (idInput) {
                        idInput.focus();
                    }
                });
            }

            const saveButton = document.getElementById('bo-save-product');
            if (saveButton) {
                saveButton.addEventListener('click', saveBackOfficeProduct);
            }

            const deleteButton = document.getElementById('bo-delete-product');
            if (deleteButton) {
                deleteButton.addEventListener('click', deleteBackOfficeProduct);
            }

            renderBackOfficeProductList();

            if (selectedProductId && MASTER_PRODUCT_DATABASE.some(p => p.id === selectedProductId)) {
                const product = MASTER_PRODUCT_DATABASE.find(p => p.id === selectedProductId);
                populateProductForm(product);
            } else if (MASTER_PRODUCT_DATABASE.length > 0) {
                selectedProductId = MASTER_PRODUCT_DATABASE[0].id;
                populateProductForm(MASTER_PRODUCT_DATABASE[0]);
                renderBackOfficeProductList();
            } else {
                clearProductForm();
            }
        }

        function renderBackOfficeProductList(filter) {
            const listEl = document.getElementById('bo-product-list');
            if (!listEl) return;
            const searchInput = document.getElementById('bo-product-search');
            const searchValue = typeof filter === 'string' ? filter : (searchInput ? searchInput.value : '');
            const normalized = searchValue.trim().toLowerCase();

            let products = [...MASTER_PRODUCT_DATABASE];
            products.sort((a, b) => (a.name || '').localeCompare(b.name || '', 'fr'));

            if (normalized) {
                products = products.filter(product => {
                    const haystack = [product.name, product.brand, ...(product.need || []), ...(product.species || [])];
                    return haystack.some(value => (value || '').toLowerCase().includes(normalized));
                });
            }

            if (products.length === 0) {
                listEl.innerHTML = '<p class="text-sm text-gray-500">Aucun produit ne correspond √† la recherche.</p>';
                return;
            }

            listEl.innerHTML = '';
            products.forEach(product => {
                const button = document.createElement('button');
                button.type = 'button';
                button.setAttribute('data-product-id', product.id);
                button.innerHTML = `<p class="font-semibold text-gray-900">${product.name}</p><p class="text-xs text-gray-500">${product.brand || '‚Äî'} ‚Ä¢ ${product.id}</p>`;
                if (product.id === selectedProductId) {
                    button.classList.add('active');
                }
                button.addEventListener('click', () => {
                    selectedProductId = product.id;
                    populateProductForm(product);
                    renderBackOfficeProductList();
                });
                listEl.appendChild(button);
            });
        }

        function buildChipGroup(containerId, type, selectedValues = []) {
            const container = document.getElementById(containerId);
            if (!container) return;
            container.innerHTML = '';

            const selectedSet = new Set(selectedValues);
            getCriteriaList(type).forEach(option => {
                const label = document.createElement('label');
                label.className = 'backoffice-chip';
                const optionLabels = option.labels && typeof option.labels === 'object' ? option.labels : {};
                if (optionLabels.fr) {
                    label.title = `${optionLabels.nl || option.value} / ${optionLabels.fr}`;
                }
                const input = document.createElement('input');
                input.type = 'checkbox';
                input.value = option.value;
                input.checked = selectedSet.has(option.value);
                label.appendChild(input);

                const text = document.createElement('span');
                text.textContent = optionLabels.nl || option.value;
                label.appendChild(text);

                container.appendChild(label);
            });

            selectedValues.forEach(value => {
                if (!getCriteriaList(type).some(option => option.value === value)) {
                    const label = document.createElement('label');
                    label.className = 'backoffice-chip missing-criteria';

                    const input = document.createElement('input');
                    input.type = 'checkbox';
                    input.value = value;
                    input.checked = true;
                    label.appendChild(input);

                    const text = document.createElement('span');
                    text.textContent = `${value} (hors crit√®res)`;
                    label.appendChild(text);

                    container.appendChild(label);
                }
            });
        }

        function getCheckedValues(containerId) {
            const container = document.getElementById(containerId);
            if (!container) return [];
            return Array.from(container.querySelectorAll('input[type="checkbox"]:checked')).map(input => input.value);
        }

        function populateProductForm(product) {
            const idInput = document.getElementById('bo-product-id');
            if (!idInput) return;

            const safeProduct = product || {};

            idInput.value = safeProduct.id || '';
            const nameInput = document.getElementById('bo-product-name');
            if (nameInput) nameInput.value = safeProduct.name || '';

            const brandInput = document.getElementById('bo-product-brand');
            if (brandInput) brandInput.value = safeProduct.brand || '';

            const categorySelect = document.getElementById('bo-product-category');
            if (categorySelect) categorySelect.value = safeProduct.category || 'Supplements';

            const linkInput = document.getElementById('bo-product-link');
            if (linkInput) linkInput.value = safeProduct.tomCoUrl || '';

            const purvisoCheckbox = document.getElementById('bo-product-purviso');
            if (purvisoCheckbox) purvisoCheckbox.checked = Boolean(safeProduct.isPurviso);

            buildChipGroup('bo-species-options', 'species', safeProduct.species || []);
            buildChipGroup('bo-age-options', 'age', safeProduct.age || []);
            buildChipGroup('bo-need-options', 'need', safeProduct.need || []);
            buildChipGroup('bo-level-options', 'level', safeProduct.level || []);

            const nlObjective = document.getElementById('bo-nl-objective');
            if (nlObjective) nlObjective.value = safeProduct.objective || '';
            const nlAdmin = document.getElementById('bo-nl-admin');
            if (nlAdmin) nlAdmin.value = safeProduct.admin || '';
            const nlWarning = document.getElementById('bo-nl-warning');
            if (nlWarning) nlWarning.value = safeProduct.warning || '';

            const translations = PRODUCT_TRANSLATIONS.fr || {};
            const frData = safeProduct.id && translations[safeProduct.id] ? translations[safeProduct.id] : {};

            const frObjective = document.getElementById('bo-fr-objective');
            if (frObjective) frObjective.value = frData.objective || '';
            const frAdmin = document.getElementById('bo-fr-admin');
            if (frAdmin) frAdmin.value = frData.admin || '';
            const frWarning = document.getElementById('bo-fr-warning');
            if (frWarning) frWarning.value = frData.warning || '';

            const deleteButton = document.getElementById('bo-delete-product');
            if (deleteButton) {
                const canDelete = Boolean(product && product.id && MASTER_PRODUCT_DATABASE.some(p => p.id === product.id));
                deleteButton.classList.toggle('hidden', !canDelete);
            }
        }

        function clearProductForm() {
            populateProductForm(null);
        }

        function showProductFeedback(message, isError = false) {
            const feedback = document.getElementById('bo-product-feedback');
            if (!feedback) return;
            feedback.textContent = message;
            feedback.className = `mt-4 text-sm ${isError ? 'text-red-600' : 'text-green-600'}`;
            if (productFeedbackTimer) {
                clearTimeout(productFeedbackTimer);
            }
            productFeedbackTimer = setTimeout(() => {
                feedback.textContent = '';
                feedback.className = 'mt-4 text-sm';
            }, 3500);
        }

        function saveBackOfficeProduct() {
            const id = getElementValue('bo-product-id').trim();
            const name = getElementValue('bo-product-name').trim();
            const brand = getElementValue('bo-product-brand').trim();
            const categoryValue = getElementValue('bo-product-category');
            const category = categoryValue ? categoryValue : 'Supplements';
            const link = getElementValue('bo-product-link').trim();
            const objective = getElementValue('bo-nl-objective').trim();
            const admin = getElementValue('bo-nl-admin').trim();
            const warning = getElementValue('bo-nl-warning').trim();
            const isPurviso = getElementChecked('bo-product-purviso');
            const species = getCheckedValues('bo-species-options');
            const age = getCheckedValues('bo-age-options');
            const need = getCheckedValues('bo-need-options');
            const level = getCheckedValues('bo-level-options');

            if (!id) {
                showProductFeedback('L‚Äôidentifiant est obligatoire.', true);
                return;
            }

            if (!name) {
                showProductFeedback('Le nom du produit est obligatoire.', true);
                return;
            }

            const idExists = MASTER_PRODUCT_DATABASE.some(p => p.id === id && p.id !== selectedProductId);
            if (idExists) {
                showProductFeedback('Cet identifiant est d√©j√† utilis√© par un autre produit.', true);
                return;
            }

            const productData = {
                id,
                name,
                brand,
                category,
                isPurviso,
                species,
                age,
                need,
                level,
                objective,
                admin,
                warning: warning || null,
                tomCoUrl: link || null
            };

            const existingIndex = MASTER_PRODUCT_DATABASE.findIndex(p => p.id === selectedProductId);

            if (existingIndex !== -1) {
                MASTER_PRODUCT_DATABASE.splice(existingIndex, 1, productData);
                if (selectedProductId && selectedProductId !== id) {
                    const frEntries = PRODUCT_TRANSLATIONS.fr || {};
                    if (frEntries[selectedProductId]) {
                        frEntries[id] = frEntries[selectedProductId];
                        delete frEntries[selectedProductId];
                    }
                }
            } else {
                MASTER_PRODUCT_DATABASE.push(productData);
            }

            selectedProductId = id;

            const frObjective = getElementValue('bo-fr-objective').trim();
            const frAdmin = getElementValue('bo-fr-admin').trim();
            const frWarning = getElementValue('bo-fr-warning').trim();

            const translationPayload = {};
            if (frObjective) translationPayload.objective = frObjective;
            if (frAdmin) translationPayload.admin = frAdmin;
            if (frWarning) translationPayload.warning = frWarning;

            if (Object.keys(translationPayload).length > 0) {
                PRODUCT_TRANSLATIONS.fr[id] = translationPayload;
            } else {
                delete PRODUCT_TRANSLATIONS.fr[id];
            }

            saveToStorage(STORAGE_KEYS.products, MASTER_PRODUCT_DATABASE);
            saveToStorage(STORAGE_KEYS.translations, PRODUCT_TRANSLATIONS);

            refreshPublicViews();
            renderBackOfficeProductList();
            populateProductForm(productData);
            showProductFeedback('Produit enregistr√© avec succ√®s.', false);
        }

        function deleteBackOfficeProduct() {
            if (!selectedProductId) {
                showProductFeedback('Aucun produit s√©lectionn√©.', true);
                return;
            }

            const confirmed = window.confirm('Supprimer ce produit du catalogue ?');
            if (!confirmed) return;

            MASTER_PRODUCT_DATABASE = MASTER_PRODUCT_DATABASE.filter(p => p.id !== selectedProductId);
            if (PRODUCT_TRANSLATIONS.fr) {
                delete PRODUCT_TRANSLATIONS.fr[selectedProductId];
            }

            saveToStorage(STORAGE_KEYS.products, MASTER_PRODUCT_DATABASE);
            saveToStorage(STORAGE_KEYS.translations, PRODUCT_TRANSLATIONS);

            selectedProductId = MASTER_PRODUCT_DATABASE.length > 0 ? MASTER_PRODUCT_DATABASE[0].id : null;

            refreshPublicViews();
            renderBackOfficeProductList();

            if (selectedProductId) {
                populateProductForm(MASTER_PRODUCT_DATABASE.find(p => p.id === selectedProductId));
            } else {
                clearProductForm();
            }

            showProductFeedback('Produit supprim√©.', false);
        }

        function renderCriteriaTab(container) {
            const sections = [
                { type: 'species', title: 'Esp√®ces disponibles', hint: 'Valeurs propos√©es dans le s√©lecteur principal.' },
                { type: 'age', title: 'Tranches d‚Äô√¢ge', hint: 'Ordre affich√© dans la liste d√©roulante.' },
                { type: 'need', title: 'Besoins principaux', hint: 'D√©termine √©galement l‚Äôordre des sections de catalogue.' },
                { type: 'level', title: 'Niveaux / Gravit√©', hint: 'Utilis√© pour filtrer les recommandations.' }
            ];

            container.innerHTML = `
                <div class="backoffice-grid">
                    ${sections.map(section => `
                        <div class="backoffice-panel" data-criteria="${section.type}">
                            <div class="flex items-center justify-between gap-3 mb-3">
                                <h3>${section.title}</h3>
                                <button type="button" class="btn-secondary text-sm px-3 py-2" data-add-criteria="${section.type}">Ajouter</button>
                            </div>
                            <div class="space-y-3" id="criteria-list-${section.type}"></div>
                            <p class="backoffice-hint mt-2">${section.hint}</p>
                        </div>
                    `).join('')}
                </div>
                <div id="criteria-feedback" class="mt-4 text-sm"></div>
                <div class="backoffice-actions">
                    <button type="button" class="btn-secondary" id="criteria-reset">R√©initialiser</button>
                    <button type="button" class="btn-primary" id="criteria-save">Enregistrer</button>
                </div>
            `;

            sections.forEach(section => renderCriteriaRows(section.type));

            container.querySelectorAll('[data-add-criteria]').forEach(button => {
                const type = button.getAttribute('data-add-criteria');
                button.addEventListener('click', () => addCriteriaRow(type));
            });

            const saveButton = document.getElementById('criteria-save');
            if (saveButton) {
                saveButton.addEventListener('click', saveCriteriaChanges);
            }

            const resetButton = document.getElementById('criteria-reset');
            if (resetButton) {
                resetButton.addEventListener('click', resetCriteriaDefaults);
            }
        }

        function renderCriteriaRows(type) {
            const container = document.getElementById(`criteria-list-${type}`);
            if (!container) return;
            container.innerHTML = '';

            const entries = getCriteriaList(type);
            if (!entries.length) {
                addCriteriaRow(type);
                return;
            }

            entries.forEach(entry => addCriteriaRow(type, entry.value, entry.labels || {}));
        }

        function addCriteriaRow(type, value = '', labels = {}) {
            const container = document.getElementById(`criteria-list-${type}`);
            if (!container) return;

            const row = document.createElement('div');
            row.className = 'criteria-row';

            const valueLabel = document.createElement('label');
            valueLabel.textContent = 'Valeur technique';
            const valueInput = document.createElement('input');
            valueInput.type = 'text';
            valueInput.setAttribute('data-field', 'value');
            valueInput.value = value;
            valueInput.placeholder = 'ex : hond';
            valueLabel.appendChild(valueInput);

            const nlLabel = document.createElement('label');
            nlLabel.textContent = 'Libell√© NL';
            const nlInput = document.createElement('input');
            nlInput.type = 'text';
            nlInput.setAttribute('data-field', 'label-nl');
            nlInput.value = labels.nl || '';
            nlInput.placeholder = 'Texte NL';
            nlLabel.appendChild(nlInput);

            const frLabel = document.createElement('label');
            frLabel.textContent = 'Libell√© FR';
            const frInput = document.createElement('input');
            frInput.type = 'text';
            frInput.setAttribute('data-field', 'label-fr');
            frInput.value = labels.fr || '';
            frInput.placeholder = 'Texte FR';
            frLabel.appendChild(frInput);

            const removeButton = document.createElement('button');
            removeButton.type = 'button';
            removeButton.className = 'btn-danger text-sm px-3 py-2';
            removeButton.textContent = 'Supprimer';
            removeButton.addEventListener('click', () => {
                row.remove();
            });

            row.appendChild(valueLabel);
            row.appendChild(nlLabel);
            row.appendChild(frLabel);
            row.appendChild(removeButton);

            container.appendChild(row);
        }

        function showCriteriaFeedback(message, isError = false) {
            const feedback = document.getElementById('criteria-feedback');
            if (!feedback) return;
            feedback.textContent = message;
            feedback.className = `mt-4 text-sm ${isError ? 'text-red-600' : 'text-green-600'}`;
            if (criteriaFeedbackTimer) {
                clearTimeout(criteriaFeedbackTimer);
            }
            criteriaFeedbackTimer = setTimeout(() => {
                feedback.textContent = '';
                feedback.className = 'mt-4 text-sm';
            }, 3500);
        }

        function saveCriteriaChanges() {
            const types = ['species', 'age', 'need', 'level'];
            const updated = {};

            types.forEach(type => {
                const container = document.getElementById(`criteria-list-${type}`);
                if (!container) return;

                const rows = Array.from(container.querySelectorAll('.criteria-row'));
                const values = [];

                rows.forEach(row => {
                    const valueInput = row.querySelector('[data-field="value"]');
                    const nlInput = row.querySelector('[data-field="label-nl"]');
                    const frInput = row.querySelector('[data-field="label-fr"]');

                    const valueField = valueInput ? valueInput.value : '';
                    const nlField = nlInput ? nlInput.value : '';
                    const frField = frInput ? frInput.value : '';
                    const value = valueField.trim();
                    const nl = nlField.trim();
                    const fr = frField.trim();

                    if (!value) return;

                    const entry = { value, labels: {} };
                    if (nl) entry.labels.nl = nl;
                    if (fr) entry.labels.fr = fr;
                    values.push(entry);
                });

                updated[type] = values;
            });

            SEARCH_CRITERIA = updated;
            saveToStorage(STORAGE_KEYS.criteria, SEARCH_CRITERIA);

            types.forEach(renderCriteriaRows);
            refreshPublicViews();

            showCriteriaFeedback('Crit√®res mis √† jour.', false);
        }

        function resetCriteriaDefaults() {
            SEARCH_CRITERIA = deepClone(DEFAULT_SEARCH_CRITERIA);
            saveToStorage(STORAGE_KEYS.criteria, SEARCH_CRITERIA);
            ['species', 'age', 'need', 'level'].forEach(renderCriteriaRows);
            refreshPublicViews();
            showCriteriaFeedback('Crit√®res r√©initialis√©s aux valeurs par d√©faut.', false);
        }

        function renderSettingsTab(container) {
            container.innerHTML = `
                <div class="backoffice-panel space-y-4">
                    <h3>Export &amp; import</h3>
                    <p class="backoffice-hint">G√©n√©rez un export JSON, importez une sauvegarde ou r√©initialisez compl√®tement la base.</p>
                    <div class="flex flex-wrap gap-3">
                        <button type="button" class="btn-secondary" id="settings-export">Exporter</button>
                        <button type="button" class="btn-primary" id="settings-import">Importer</button>
                        <button type="button" class="btn-danger" id="settings-reset">R√©initialiser</button>
                    </div>
                    <textarea id="settings-json" class="w-full border border-gray-300 rounded-lg p-3" rows="10" placeholder="Collez ici un JSON compatible puis cliquez sur ‚ÄúImporter‚Äù."></textarea>
                    <div id="settings-feedback" class="text-sm"></div>
                </div>
            `;

            const exportButton = document.getElementById('settings-export');
            if (exportButton) {
                exportButton.addEventListener('click', () => {
                    const payload = {
                        products: MASTER_PRODUCT_DATABASE,
                        translations: PRODUCT_TRANSLATIONS,
                        criteria: SEARCH_CRITERIA
                    };
                    const textarea = document.getElementById('settings-json');
                    if (textarea) {
                        textarea.value = JSON.stringify(payload, null, 2);
                        textarea.focus();
                        textarea.select();
                    }
                    showSettingsFeedback('Export g√©n√©r√©. Copiez ou t√©l√©chargez le JSON affich√©.', false);
                });
            }

            const importButton = document.getElementById('settings-import');
            if (importButton) {
                importButton.addEventListener('click', importBackOfficeData);
            }

            const resetButton = document.getElementById('settings-reset');
            if (resetButton) {
                resetButton.addEventListener('click', resetAllBackOfficeData);
            }
        }

        function showSettingsFeedback(message, isError = false) {
            const feedback = document.getElementById('settings-feedback');
            if (!feedback) return;
            feedback.textContent = message;
            feedback.className = `text-sm ${isError ? 'text-red-600' : 'text-green-600'}`;
            if (settingsFeedbackTimer) {
                clearTimeout(settingsFeedbackTimer);
            }
            settingsFeedbackTimer = setTimeout(() => {
                feedback.textContent = '';
                feedback.className = 'text-sm';
            }, 4000);
        }

        function importBackOfficeData() {
            const textarea = document.getElementById('settings-json');
            if (!textarea) return;

            try {
                const parsed = JSON.parse(textarea.value || '');
                if (!parsed || typeof parsed !== 'object') {
                    throw new Error('Invalid data');
                }

                if (Array.isArray(parsed.products)) {
                    MASTER_PRODUCT_DATABASE = parsed.products;
                }
                if (parsed.translations && typeof parsed.translations === 'object') {
                    PRODUCT_TRANSLATIONS = parsed.translations;
                    if (!PRODUCT_TRANSLATIONS.fr) {
                        PRODUCT_TRANSLATIONS.fr = {};
                    }
                }
                if (parsed.criteria && typeof parsed.criteria === 'object') {
                    SEARCH_CRITERIA = parsed.criteria;
                }

                saveToStorage(STORAGE_KEYS.products, MASTER_PRODUCT_DATABASE);
                saveToStorage(STORAGE_KEYS.translations, PRODUCT_TRANSLATIONS);
                saveToStorage(STORAGE_KEYS.criteria, SEARCH_CRITERIA);

                selectedProductId = MASTER_PRODUCT_DATABASE.length > 0 ? MASTER_PRODUCT_DATABASE[0].id : null;

                refreshPublicViews();
                updateBackOfficeTabs();
                renderBackOfficeContent();

                showSettingsFeedback('Import r√©alis√© avec succ√®s.', false);
            } catch (error) {
                console.error('Import error', error);
                showSettingsFeedback('Import impossible : v√©rifiez le JSON fourni.', true);
            }
        }

        function resetAllBackOfficeData() {
            const confirmed = window.confirm('R√©initialiser toutes les donn√©es (produits, traductions, crit√®res) ?');
            if (!confirmed) return;

            MASTER_PRODUCT_DATABASE = deepClone(DEFAULT_PRODUCT_DATABASE);
            PRODUCT_TRANSLATIONS = deepClone(DEFAULT_PRODUCT_TRANSLATIONS);
            if (!PRODUCT_TRANSLATIONS.fr) {
                PRODUCT_TRANSLATIONS.fr = {};
            }
            SEARCH_CRITERIA = deepClone(DEFAULT_SEARCH_CRITERIA);

            selectedProductId = MASTER_PRODUCT_DATABASE.length > 0 ? MASTER_PRODUCT_DATABASE[0].id : null;

            saveToStorage(STORAGE_KEYS.products, MASTER_PRODUCT_DATABASE);
            saveToStorage(STORAGE_KEYS.translations, PRODUCT_TRANSLATIONS);
            saveToStorage(STORAGE_KEYS.criteria, SEARCH_CRITERIA);

            refreshPublicViews();
            updateBackOfficeTabs();
            renderBackOfficeContent();

            showSettingsFeedback('Toutes les donn√©es ont √©t√© r√©initialis√©es.', false);
        }

        function applyLanguage() {
            const langData = getLangData();
            document.title = langData.pageTitle;
            document.documentElement.lang = langData.htmlLang;

            document.querySelectorAll('[data-i18n]').forEach(element => {
                const key = element.getAttribute('data-i18n');
                const translation = langData.texts[key];
                if (translation !== undefined) {
                    element.innerHTML = translation;
                }
            });

            document.querySelectorAll('[data-i18n-placeholder]').forEach(element => {
                const key = element.getAttribute('data-i18n-placeholder');
                const translation = langData.texts[key];
                if (translation !== undefined) {
                    element.setAttribute('placeholder', translation);
                }
            });

            renderSearchCriteria();
        }

        function setLanguage(lang) {
            if (!LANGUAGE_DATA[lang]) return;
            currentLanguage = lang;

            applyLanguage();
            fillCatalog('full-supplements-accordion', 'Supplements');
            fillCatalog('full-care-accordion', 'Soins');

            document.querySelectorAll('[data-language-btn]').forEach(button => {
                const isActive = button.getAttribute('data-language-btn') === lang;
                button.classList.toggle('active', isActive);
                button.setAttribute('aria-pressed', isActive);
            });

            const messageDiv = document.getElementById('message');
            if (!messageDiv.classList.contains('hidden') && messageDiv.innerHTML.trim() !== '') {
                findProduct();
            }
        }

        // Functie voor de accordion
        function toggleAccordion(id) {
            const content = document.getElementById(id);
            const header = content.previousElementSibling;
            const icon = header.querySelector('svg');

            if (content.classList.contains('open')) {
                content.classList.remove('open');
                icon.classList.remove('rotate-90');
            } else {
                content.classList.add('open');
                icon.classList.add('rotate-90');
            }
        }
        
        // Functie om de selector te resetten
        function resetSelector() {
            document.getElementById('species').value = "";
            document.getElementById('age').value = "";
            document.getElementById('need').value = "";
            document.getElementById('level').value = "";
            document.getElementById('healthNotes').value = "";
            document.getElementById('message').classList.add('hidden');
            document.getElementById('message').innerHTML = "";
        }
        
        // Functie om de popup te sluiten
        function closeProductModal() {
            document.getElementById('product-modal').classList.remove('open');
        }

        // Functie om een product te tonen in de popup
        function openProductModal(product) {
            document.getElementById('modal-title').textContent = product.name;
            const body = document.getElementById('modal-body');
            body.innerHTML = ''; // Leeg de inhoud

            const langData = getLangData();
            const messages = langData.productMessages;
            const objectiveText = getLocalizedField(product, 'objective') || '';
            const adminText = getLocalizedField(product, 'admin') || '';
            const warningText = getLocalizedField(product, 'warning');

            // Doel / Objectif
            let objective = `<p><strong>${messages.objective}</strong> ${objectiveText}</p>`;
            // Gebruik/Toediening
            let admin = `<p><strong>${messages.admin}</strong> ${adminText}</p>`;
            // Waarschuwing
            let warning = warningText ? `<p class="alert-warning p-2 rounded-lg mt-3"><strong>${messages.warning}</strong> ${warningText}</p>` : '';
            // Merk/Status
            const categoryLabel = langData.modal.categories[product.category] || product.category;
            const priorityLabel = product.isPurviso ? langData.modal.purviso : langData.modal.external;
            let status = `<p class="mt-4 text-sm text-gray-500">${langData.modal.brand}: <strong>${product.brand}</strong> | ${langData.modal.category}: ${categoryLabel} | ${langData.modal.priority}: ${priorityLabel}</p>`;

            body.innerHTML = objective + admin + warning + status;

            document.getElementById('product-modal').classList.add('open');
        }
        
        // Functie voor de selector (de kernlogica)
        function findProduct() {
            const species = document.getElementById('species').value;
            const age = document.getElementById('age').value;
            const need = document.getElementById('need').value;
            const level = document.getElementById('level').value;
            const healthNotes = document.getElementById('healthNotes').value;
            const messageDiv = document.getElementById('message');
            const messages = getLangData().productMessages;

            messageDiv.classList.remove('hidden', 'alert-error', 'alert-success', 'alert-warning');
            messageDiv.innerHTML = '';

            // Valideren van de ingevoerde gegevens
            if (!species) return displayMessage(messageDiv, messages.error_species, 'alert-error');
            if (!age) return displayMessage(messageDiv, messages.error_age, 'alert-error');
            if (!need) return displayMessage(messageDiv, messages.error_need, 'alert-error');
            if (!level) return displayMessage(messageDiv, messages.error_level, 'alert-error');

            // 1. Zoek naar het Purviso huismerkproduct
            let recommendedProduct = MASTER_PRODUCT_DATABASE.find(p => 
                p.isPurviso && 
                p.species.includes(species) &&
                p.age.includes(age) &&
                p.need.includes(need) &&
                p.level.includes(level)
            );

            // 2. Zoek naar alternatieve compatibele producten
            let alternatives = MASTER_PRODUCT_DATABASE.filter(p => 
                !p.isPurviso && 
                p.species.includes(species) &&
                p.age.includes(age) &&
                p.need.includes(need) &&
                p.level.includes(level)
            );

            // Verwijder het aanbevolen product uit de alternatieven als ze identiek zijn (niet nodig hier, maar goede gewoonte)
            if (recommendedProduct) {
                 alternatives = alternatives.filter(p => p.id !== recommendedProduct.id);
            }

            // 3. Toon de resultaten
            let html = `<strong>${messages.recommendation_intro}</strong><br>`;

            if (recommendedProduct) {
                html += renderProduct(recommendedProduct, messages.purviso_priority);
            } else if (alternatives.length > 0) {
                // Als er geen Purviso is, maar wel een alternatief, toon het beste alternatief als 'aanbevolen'
                recommendedProduct = alternatives.shift(); // Haal het eerste alternatief eruit
                html += renderProduct(recommendedProduct, messages.other_alternative);
            } else {
                return displayMessage(messageDiv, messages.no_product, 'alert-warning');
            }

            // Toon resterende alternatieven
            if (alternatives.length > 0) {
                html += `<h4 class="text-lg font-semibold text-gray-700 mt-6 mb-3">${messages.alternative_intro}</h4>`;
                alternatives.forEach(alt => {
                    html += renderProduct(alt, messages.other_alternative);
                });
            }

            // Voeg notitie over gezondheidsnotities toe indien ingevoerd
            if (healthNotes.trim() !== '') {
                html += `<p class="alert-warning p-2 rounded-lg text-sm mt-4">${messages.notes_warning}</p>`;
            }

            displayMessage(messageDiv, html, 'alert-success');
        }

        // Hulpmiddelen voor weergave
        function displayMessage(div, message, type) {
            div.innerHTML = message;
            div.classList.add(type);
            div.classList.remove('hidden');
        }

        function renderProduct(product, tag) {
            const langData = getLangData();
            const objectiveText = getLocalizedField(product, 'objective') || '';
            const truncatedObjective = objectiveText.length > 100 ? `${objectiveText.substring(0, 100)}...` : objectiveText;
            const needLabel = getCriteriaLabel('need', product.need[0]) || langData.tagLabels[product.need[0]] || product.need[0];
            const levelLabel = getCriteriaLabel('level', product.level[0]) || langData.tagLabels[product.level[0]] || product.level[0];

            return `
                <div class="product-item p-4 mt-3 rounded-lg shadow-sm bg-white cursor-pointer hover:bg-gray-50 transition duration-150" onclick="openProductModal(MASTER_PRODUCT_DATABASE.find(p => p.id === '${product.id}'))">
                    <p class="text-sm text-log-teal font-medium mb-1">${tag}</p>
                    <h3 class="text-base font-bold text-gray-900">${product.name}</h3>
                    <p class="text-sm text-gray-600 truncate">${truncatedObjective}</p>
                    <div class="flex flex-wrap gap-2 mt-2 text-xs">
                        <span class="bg-gray-100 text-gray-800 px-2 py-1 rounded-full">${needLabel}</span>
                        <span class="bg-gray-100 text-gray-800 px-2 py-1 rounded-full">${levelLabel}</span>
                        <span class="bg-log-orange text-white px-2 py-1 rounded-full">${product.brand}</span>
                    </div>
                </div>
            `;
        }
        
        // Nieuwe functie om de volledige catalogi per BEHOEFTE te vullen
        function fillCatalog(containerId, category) {
            const container = document.getElementById(containerId);
            if (!container) return;
            const langData = getLangData();

            // 1. Haal de producten op voor de specifieke categorie (Supplements of Soins)
            const filteredProducts = MASTER_PRODUCT_DATABASE.filter(p => p.category === category);

            // 2. Verzamel alle unieke 'need' tags en sorteer ze op basis van de volgorde in de selectielijst
            const allNeeds = [];
            filteredProducts.forEach(product => {
                const productNeeds = Array.isArray(product.need) ? product.need : [];
                productNeeds.forEach(needKey => {
                    if (!allNeeds.includes(needKey)) {
                        allNeeds.push(needKey);
                    }
                });
            });
            
            const orderedNeedKeys = getCriteriaList('need').map(option => option.value);

            const sortedNeeds = orderedNeedKeys.filter(key => allNeeds.includes(key)).concat(
                allNeeds.filter(key => !orderedNeedKeys.includes(key))
            );


            let html = '';
            
            sortedNeeds.forEach(needKey => {
                // Groeperen per behoefte
                const productsForNeed = filteredProducts.filter(p => p.need.includes(needKey));
                
                // Overslaan als er geen producten zijn (bijvoorbeeld, 'articulations' in Soins-lijst)
                if (productsForNeed.length === 0) return;

                const needTitle = getCriteriaLabel('need', needKey) || langData.tagLabels[needKey] || needKey;
                const needId = `${category}-${needKey}`;

                let productList = productsForNeed.map(p => {
                    const statusTag = p.isPurviso ?
                        `<span class="bg-[#fef4f2] text-log-teal text-xs font-semibold px-2 py-1 rounded-full">${langData.catalog.purvisoTag}</span>` :
                        `<span class="bg-gray-100 text-gray-800 text-xs font-semibold px-2 py-1 rounded-full">${p.brand}</span>`;
                    const objectiveText = getLocalizedField(p, 'objective') || '';

                    return `
                        <div class="flex justify-between items-center product-item p-3 cursor-pointer hover:bg-gray-50 transition duration-150" onclick="openProductModal(MASTER_PRODUCT_DATABASE.find(prod => prod.id === '${p.id}'))">
                            <div class="flex-1 min-w-0 pr-4">
                                <p class="text-gray-900 font-medium">${p.name}</p>
                                <p class="text-xs text-gray-500 truncate">${objectiveText}</p>
                            </div>
                            ${statusTag}
                        </div>
                    `;
                }).join('');

                html += `
                    <div>
                        <div class="accordion-header flex justify-between items-center text-lg font-semibold text-gray-800 border-t" onclick="toggleAccordion('${needId}')">
                            <span class="flex items-center">
                                ${needTitle} (${langData.catalog.groupCount(productsForNeed.length)})
                            </span>
                            <svg class="w-4 h-4 transition-transform duration-300 text-log-teal" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path>
                            </svg>
                        </div>
                        <div id="${needId}" class="accordion-content">
                            ${productList}
                        </div>
                    </div>
                `;
            });

            container.innerHTML = html;
        }

        // Vul de catalogi bij het laden van de pagina en activeer de taalselector
        document.addEventListener('DOMContentLoaded', () => {
            document.querySelectorAll('[data-language-btn]').forEach(button => {
                button.addEventListener('click', () => setLanguage(button.getAttribute('data-language-btn')));
            });

            const openBackofficeButton = document.getElementById('open-backoffice');
            if (openBackofficeButton) {
                openBackofficeButton.addEventListener('click', () => {
                    if (isBackOfficeAuthenticated) {
                        openBackOfficePanel(activeBackOfficeTab);
                    } else {
                        openBackOfficeLogin();
                    }
                });
            }

            const authButton = document.getElementById('backoffice-auth-btn');
            if (authButton) {
                authButton.addEventListener('click', handleBackOfficeAuth);
            }

            const codeInput = document.getElementById('backoffice-code');
            if (codeInput) {
                codeInput.addEventListener('keydown', event => {
                    if (event.key === 'Enter') {
                        event.preventDefault();
                        handleBackOfficeAuth();
                    }
                });
            }

            document.querySelectorAll('.backoffice-overlay').forEach(overlay => {
                overlay.addEventListener('click', event => {
                    if (event.target !== overlay) return;
                    if (overlay.id === 'backoffice-login') {
                        closeBackOfficeLogin();
                    } else if (overlay.id === 'backoffice-panel') {
                        closeBackOfficePanel();
                    }
                });
            });

            document.addEventListener('keydown', event => {
                if (event.key === 'Escape') {
                    closeBackOfficeLogin();
                    closeBackOfficePanel();
                }
            });

            document.querySelectorAll('#backoffice-panel .backoffice-tab').forEach(button => {
                button.addEventListener('click', () => {
                    const tab = button.getAttribute('data-tab');
                    switchBackOfficeTab(tab);
                });
            });

            setLanguage(currentLanguage);
        });

    </script>
</body>
</html>
